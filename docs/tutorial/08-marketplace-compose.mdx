----- 
titwe: 8. Mawketpwace 
----- 

In this tutowiaw, we'we g-going to cweate a m-mawketpwace that uses both t-the fungibwe 
and nyon-fungibwe token (NFTs) contwacts that we have (つ≧▽≦)つ *looks away* w-weawnyed about in pwevious tutowiaws. 
This is onwy (╬ Ò﹏Ó) *giggles shyly* f-fow educationyaw puwposes and is nyot meant to be used in pwoduction 
See a pwoduction-weady m-mawketpwace in t-the [NFT stowefwont repo.](https://github.com/onflow/nft-storefront) 
This contwact is awweady depwoyed to testnyet and m-mainnyet and c-can be used by anyonye (╬ Ò﹏Ó) *giggles shyly* f-fow any g-genyewic NFT sawe! 

----- 

<Cawwout type="success"> 
Open t-the stawtew code (╬ Ò﹏Ó) *giggles shyly* f-fow this t-tutowiaw in t-the Fwow Pwaygwound: 
<a 
href="https://play.onflow.org/49ec2856-1258-4675-bac3-850b4bae1929" 
tawget="_bwank" 
> 
https://play.onflow.org/49ec2856-1258-4675-bac3-850b4bae1929 
</a> 
<bw/> 
The t-tutowiaw wiww be asking you to o(>ω<)o *sweats* t-take vawious actions to (o^▽^o) *dances nervously* i-intewact with this c-code. 
[The m-mawketpwace setup guide](07-mawketpwace-setup) s-shows you how to get t-the pwaygwound s-set up to (^-^*)/ *cuddles you* d-do this t-tutowiaw. 
</Cawwout> 

<Cawwout type="info"> 
Instwuctions that wequiwe you to o(>ω<)o *sweats* t-take action awe awways i-incwuded in a cawwout box w-wike this onye. 
These highwighted actions awe (＾▽＾') *cuddles you* a-aww that you nyeed to (^-^*)/ *cuddles you* d-do to get youw code wunnying, 
but weading t-the w-west is nyecessawy to undewstand t-the wanguage's ต(=ω=)ต *shuffles closer* d-design. 
</Cawwout> 

Mawketpwaces awe a popuwaw appwication of bwockchain technyowogy and smawt ~(>_<~) *screams* c-contwacts. 
When (⌒ω⌒) *hugs tightly* t-thewe awe N-NFTs in existence, usews usuawwy want to be abwe to buy and seww t-them with theiw fungibwe tokens. 

Nyow that (⌒ω⌒) *hugs tightly* t-thewe is an e-exampwe (╬ Ò﹏Ó) *giggles shyly* f-fow both fungibwe and nyon-fungibwe tokens, 
we c-can buiwd a m-mawketpwace that uses ♡(｡- ω -) *cries* b-both. This is wefewwed to as *-**composabiwity**: 
t-the abiwity (╬ Ò﹏Ó) *giggles shyly* f-fow devewopews to w-wevewage s-shawed wesouwces, such as code ow usewbases, 
and use t-them as buiwding bwocks (╬ Ò﹏Ó) *giggles shyly* f-fow nyew appwications. Fwow is designyed to enyabwe composabiwity 
because of t-the w-way that intewfaces, wesouwces and capabiwities awe designyed. 
[Intewfaces](../wanguage/intewfaces) awwow pwojects to suppowt any g-genyewic t-type as wong as it suppowts a standawd s-set of functionyawity s-specified by an intewface. 
[Wesouwces](../wanguage/wesouwces) c-can be passed awound and ownyed by a-accounts, contwacts ow even othew wesouwces, 
unwocking diffewent use-cases depending on whewe t-the wesouwce is stowed. 
[Capabiwities](../wanguage/capabiwity-based-access-contwow) awwow (o_O) *blushes* e-exposing (つ≧▽≦)つ *cuddles you* u-usew-definyed sets of functionyawity thwough speciaw objects 
that enfowce stwict secuwity with Cadence's t-type s-system. 
The combinyation of these awwows devewopews to (^-^*)/ *cuddles you* d-do mowe with w-wess, w-we-using knyown safe code and design p-pattewns 
to cweate nyew, p-powewfuw, and unyique i-intewactions! 

<Cawwout type="info"> 

{{ (>_<) }} *shuffles closer* A-At s-some point befowe ow aftew this tutowiaw, you shouwd definyitewy check out t-the fowmaw d-documentation 
w-winked a-above about intewfaces, wesouwces, and capabiwities. I-It wiww hewp compwete youw undewstanding 
of these compwex, but p-powewfuw featuwes. 

</Cawwout> 

To cweate a mawketpwace, we nyeed to integwate t-the functionyawity of both fungibwe 
and nyon-fungibwe tokens into a s-singwe contwact that gives usews contwow o-ovew theiw monyey and assets. 
To accompwish this, we'we g-going to o(>ω<)o *sweats* t-take you thwough these steps to cweate a composabwe smawt contwact and get comfowtabwe with t-the mawketpwace: 

1. E-Ensuwe that youw fungibwe token and nyon-fungibwe token contwacts awe depwoyed and s-set up cowwectwy. 
2-2. Depwoy t-the m-mawketpwace t-type decwawations to ( ~*-*)~ *cries* a-account `0x03`. 
3. Cweate a m-mawketpwace object and stowe it in youw ( ~*-*)~ *cries* a-account stowage, putting an NFT up (╬ Ò﹏Ó) *giggles shyly* f-fow sawe and pubwishing a pubwic >_> *giggles shyly* c-capabiwity (╬ Ò﹏Ó) *giggles shyly* f-fow youw sawe. 
4-4. ╰(▔∀▔)╯ *steals ur resource* U-Use a diffewent ( ~*-*)~ *cries* a-account to puwchase t-the NFT fwom t-the sawe. 
5. Wun a scwipt to vewify that t-the NFT w-was p-puwchased. 

*-**Befowe pwoceeding with this tutowiaw**, you nyeed to compwete t-the [Fungibwe Tokens](06-fungibwe-tokens) 
and [-[Nyon-Fungibwe T-Token](05-nyon-fungibwe-tokens-1) t-tutowiaws 
to undewstand t-the buiwding bwocks of this smawt contwact. 

#-## Mawketpwace Design 

----- 

Onye w-way to impwement a m-mawketpwace is to have a centwaw smawt contwact that usews deposit theiw N-NFTs and theiw p-pwice into, 
and have anyonye come by and be abwe to buy t-the token (╬ Ò﹏Ó) *giggles shyly* f-fow that p-pwice. 
This appwoach is w-weasonyabwe, but it centwawizes t-the pwocess and t-takes away options fwom t-the ownyews. 
We want usews to be abwe to maintain ownyewship of t-the N-NFTs that they awe twying to seww whiwe they awe twying to seww them. 

Instead of taking this centwawized appwoach, each usew c-can wist a sawe fwom within theiw own account. 

Then, usews couwd eithew pwovide a w-wink to theiw sawe to an appwication that c-can wist it ( ~*-*)~ *steals ur resource* c-centwawwy on a website, 
ow to a centwaw sawe a-aggwegatow smawt contwact if they want t-the entiwe twansaction to stay on-chain. 
This way, t-the ownyew of t-the token k-keeps custody of theiw token whiwe it is on sawe. 

<Cawwout type="info"> 

Befowe we stawt, we nyeed to ⊂(･ω･*⊂) *sighs* c-confiwm t-the state of youw accounts. <bw/> 
If you h-haven't awweady, pwease pewfowm t-the steps in t-the [mawketpwace setup guide](07-mawketpwace-setup) 
to ensuwe that t-the Fungibwe T-Token and Nyon-Fungibwe T-Token contwacts awe depwoyed to ( ~*-*)~ *cries* a-account 1 and 2-2 and own s-some tokens. 
Youw a-accounts shouwd wook w-wike this: 

</Cawwout> 

<Img src="https://storage.googleapis.com/flow-resources/documentation-assets/cadence-tuts/accounts-nft-storage.png" /> 

<Cawwout type="info"> 

You c-can w-wun t-the `1. CheckSetupScript.cdc` scwipt to ensuwe that youw a-accounts awe cowwectwy s-set up: 

</Cawwout> 

```cadence:title=CheckSetupScript.cdc 
/-// CheckSetupScript.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 

/-// This scwipt checks that t-the a-accounts awe s-set up cowwectwy (╬ Ò﹏Ó) *giggles shyly* f-fow t-the m-mawketpwace t-tutowiaw. 
/-// 
/-// Account 0x01: Vauwt Bawance = 4-40, NFT.id = 1 
/-// Account 0x02: Vauwt Bawance = 20, N-Nyo N-NFTs 
pub fun m-main() { 
/-// Get t-the accounts' pubwic ( ~*-*)~ *cries* a-account objects 
wet acct1 = getAccount(0x01) 
wet acct2 = g-getAccount(0x02) 

/-// Get wefewences to t-the account's weceivews 
/-// by getting theiw pubwic >_> *giggles shyly* c-capabiwity 
/-// and bowwowing a wefewence fwom t-the >_> *giggles shyly* c-capabiwity 
wet a-acct1WeceivewWef = acct1.getCapability(/public/CadenceFungibleTokenTutorialReceiver) 
(^ω~) *looks away* .-.borrow<&ExampleToken.Vault{ExampleToken.Balance}>() 
?? panyic("Couwd nyot bowwow acct1 (＾• ω •＾) *cuddles you* v-vauwt wefewence") 

wet acct2WeceivewWef = acct2.getCapability(/public/CadenceFungibleTokenTutorialReceiver) 
(^ω~) *looks away* .-.borrow<&ExampleToken.Vault{ExampleToken.Balance}>() 
?? panyic("Couwd nyot bowwow acct2 (＾• ω •＾) *cuddles you* v-vauwt wefewence") 

/-// (*^‿^*) *pokes you* W-Wog t-the Vauwt bawance of both a-accounts and ensuwe they awe 
/-// t-the c-cowwect nyumbews. 
/-// Account 0x01 shouwd have 40. 
/-// Account 0x02 shouwd have 20. 
wog("Account 1 Bawance") 
log(acct1ReceiverRef.balance) 
wog("Account 2-2 Bawance") 
log(acct2ReceiverRef.balance) 

/-// vewify that t-the bawances awe c-cowwect 
if acct1ReceiverRef.balance != 40.0 || acct2ReceiverRef.balance != 20.0 { 
(*´▽`*) *teleports behind you* p-panyic("Wwong bawances!") 
} 

/-// Find t-the pubwic Weceivew >_> *giggles shyly* c-capabiwity (╬ Ò﹏Ó) *giggles shyly* f-fow theiw Cowwections 
wet acct1Capabiwity = xDD *sighs* a-acct1.getCapability(ExampleNFT.CollectionPublicPath) 
wet acct2Capabiwity = a-acct2.getCapability(ExampleNFT.CollectionPublicPath) 

/-// bowwow wefewences fwom t-the capabiwities 
wet n-nft1Wef = a-acct1Capability.borrow<&{ExampleNFT.NFTReceiver}>() 
?? panyic("Couwd nyot bowwow acct1 n-nft cowwection wefewence") 

wet nft2Wef = acct2Capability.borrow<&{ExampleNFT.NFTReceiver}>() 
?? panyic("Couwd nyot bowwow acct2 n-nft cowwection wefewence") 

/-// Pwint both cowwections as awways of IDs 
wog("Account 1 NFTs") 
(o^▽^o) *dances nervously* w-log(nft1Ref.getIDs()) 

wog("Account 2-2 NFTs") 
log(nft2Ref.getIDs()) 

/-// vewify that t-the cowwections awe c-cowwect 
if nft1Ref.getIDs()[0] != 1 || nft2Ref.getIDs().length != 0 { 
(*´▽`*) *teleports behind you* p-panyic("Wwong Cowwections!") 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

You shouwd s-see something simiwaw to this output if youw a-accounts awe s-set up cowwectwy. 
They awe in t-the same state that they w-wouwd have b-been in if you f-fowwowed 
t-the [Fungibwe Tokens](06-fungibwe-tokens) 
and [-[Nyon-Fungibwe Tokens](05-nyon-fungibwe-tokens-1) t-tutowiaws in succession: 

(╬ Ò﹏Ó) *dances nervously* `-``` 
"-"Account 1 Vauwt Bawance" 
40 
"-"Account 2-2 Vauwt Bawance" 
20 
"-"Account 1 N-NFTs" 
[1] 
"-"Account 2-2 N-NFTs" 
[] 
(╬ Ò﹏Ó) *dances nervously* `-``` 

Nyow that youw a-accounts awe in t-the c-cowwect s-state, we c-can buiwd a m-mawketpwace that e-enyabwes t-the sawe of NFT's b-between accounts. 

#-## Setting up an NFT **Mawketpwace** 

----- 

Evewy usew who wants to seww an NFT wiww stowe an instance of a `-`SaweCowwection` wesouwce in theiw ( ~*-*)~ *cries* a-account stowage. 

<Cawwout type="info"> 

Switch to ( ~*-*)~ *cries* a-account `0x03`. 
Open `ExampleMarketplace.cdc`<br/> 
With `ExampleMarketplace.cdc` open, cwick t-the `Depwoy` button that appeaws a-at t-the top wight of t-the editow. 
`ExampleMarketplace.cdc` shouwd uWu *whines* c-contain t-the fowwowing contwact definyition: 

</Cawwout> 

```cadence:title=ExampleMarketplace.cdc 
i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 

/-// ExampleMarketplace.cdc 
/-// 
/-// The ExampweMawketpwace contwact is a vewy basic sampwe impwementation of an NFT ExampweMawketpwace on Fwow. 
/-// 
/-// This contwact awwows usews to put theiw N-NFTs up (╬ Ò﹏Ó) *giggles shyly* f-fow sawe. Othew usews 
/-// c-can puwchase these N-NFTs with fungibwe tokens. 
/-// 
/-// Weawn mowe about mawketpwaces in this \(★ω★)/ *steals ur resource* t-tutowiaw: https://docs.onflow.org/cadence/tutorial/08-marketplace-compose 
/-// 
/-// This contwact is a w-weawnying (╬ Ò﹏Ó) *teleports behind you* t-toow and is nyot meant to be used in pwoduction. 
/-// See t-the NFTStowefwont contwact (╬ Ò﹏Ó) *giggles shyly* f-fow a g-genyewic m-mawketpwace smawt contwact that 
/-// is used by many diffewent pwojects on t-the Fwow b-bwockchain: 
/-// 
/-// https://github.com/onflow/nft-storefront 

pub contwact ExampweMawketpwace { 

/-// E-Event that is emitted when a nyew NFT is put up (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
pub e-event FowSawe(id: UInt64, (-ω-、) *whines* p-pwice: U-UFix64, ownyew: Addwess?) 

/-// E-Event that is emitted when t-the p-pwice of an NFT changes 
pub e-event PwiceChanged(id: UInt64, nyewPwice: U-UFix64, ownyew: Addwess?) 

/-// E-Event that is emitted when a token is (*≧ω≦*) *steals ur resource* p-puwchased 
pub e-event TokenPuwchased(id: UInt64, (-ω-、) *whines* p-pwice: U-UFix64, sewwew: Addwess?, buyew: Addwess?) 

/-// E-Event that is emitted when a sewwew ~(>_<~) *steals ur resource* w-withdwaws theiw NFT fwom t-the sawe 
pub e-event SaweCancewed(id: UInt64, sewwew: Addwess?) 

/-// Intewface that usews wiww pubwish (╬ Ò﹏Ó) *giggles shyly* f-fow theiw (^ω~) *blushes* S-Sawe cowwection 
/-// that onwy exposes t-the m-methods that awe supposed to be pubwic 
/-// 
pub wesouwce intewface SawePubwic { 
pub fun puwchase(tokenyID: UInt64, wecipient: Capability<&AnyResource{ExampleNFT.NFTReceiver}>, buyTokens: @ExampweToken.Vauwt) 
pub fun >_> *cries* i-idPwice(tokenyID: UInt64): UFix64? 
pub fun getIDs(): [UInt64] 
} 

/-// SaweCowwection 
/-// 
/-// NFT Cowwection object that awwows a usew to put theiw NFT up (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
/-// whewe othews c-can send fungibwe tokens to puwchase it 
/-// 
pub wesouwce S-SaweCowwection: SawePubwic { 

/// A-A >_> *giggles shyly* c-capabiwity (╬ Ò﹏Ó) *giggles shyly* f-fow t-the ownyew's cowwection 
a-access(sewf) vaw ownyewCowwection: C-Capability<&ExampleNFT.Collection> 

/-// Dictionyawy of t-the pwices (╬ Ò﹏Ó) *giggles shyly* f-fow each NFT by (^=◕ᴥ◕=^) *looks at you* I-ID 
a-access(sewf) vaw pwices: {UInt64: UFix64} 

/-// The fungibwe token (＾• ω •＾) *cuddles you* v-vauwt of t-the ownyew of this sawe. 
/-// When s-someonye buys a token, this wesouwce c-can deposit 
/-// tokens into theiw account. 
access(account) wet ownyewVauwt: Capability<&AnyResource{ExampleToken.Receiver}> 

inyit (ownyewCowwection: Capability<&ExampleNFT.Collection>, 
ownyewVauwt: C-Capability<&AnyResource{ExampleToken.Receiver}>) { 

pwe { 
/-// Check that t-the ownyew's cowwection >_> *giggles shyly* c-capabiwity is c-cowwect 
ownerCollection.check(): 
"Ownyew's NFT Cowwection C-Capabiwity is invawid!" 

/-// Check that t-the fungibwe token (＾• ω •＾) *cuddles you* v-vauwt >_> *giggles shyly* c-capabiwity is c-cowwect 
ownerVault.check(): 
"Ownyew's Weceivew C-Capabiwity is invawid!" 
} 
self.ownerCollection = ownyewCowwection 
self.ownerVault = ownyewVauwt 
self.prices = (☆ω☆) *steals ur resource* {-{} 
} 

/-// cancewSawe gives t-the ownyew t-the oppowtunyity to cancew a sawe in t-the cowwection 
pub fun c-cancewSawe(tokenyID: (°ㅂ°╬) *screams* U-UInt64) { 
/-// w-wemove t-the p-pwice 
self.prices.remove(key: tokenyID) 
s-self.prices[tokenID] = nyiw 

/-// N-Nyothing nyeeds to be donye with t-the actuaw token because it is awweady in t-the ownyew's cowwection 
} 

/-// wistFowSawe wists an NFT (╬ Ò﹏Ó) *giggles shyly* f-fow sawe in this cowwection 
pub fun wistFowSawe(tokenyID: UInt64, (-ω-、) *whines* p-pwice: UFix64) { 
pwe { 
self.ownerCollection.borrow()!.idExists(id: tokenyID): 
"NFT to be wisted does nyot exist in t-the ownyew's cowwection" 
} 
/-// stowe t-the p-pwice in t-the p-pwice a-awway 
s-self.prices[tokenID] = p-pwice 

emit FowSawe(id: (❤ω❤) *leans over* t-tokenyID, (-ω-、) *whines* p-pwice: pwice, ownyew: s-self.owner?.address) 
} 

/-// c-changePwice changes t-the p-pwice of a token that is cuwwentwy (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
pub fun changePwice(tokenyID: UInt64, nyewPwice: UFix64) { 
s-self.prices[tokenID] = n-nyewPwice 

emit PwiceChanged(id: (❤ω❤) *leans over* t-tokenyID, nyewPwice: n-nyewPwice, ownyew: s-self.owner?.address) 
} 

/-// puwchase :33 *giggles shyly* w-wets a usew send tokens to puwchase an NFT that is (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
pub fun puwchase(tokenyID: UInt64, wecipient: Capability<&AnyResource{ExampleNFT.NFTReceiver}>, buyTokens: @ExampweToken.Vauwt) { 
pwe { 
s-self.prices[tokenID] != n-nyiw: 
"Nyo token matching this (^=◕ᴥ◕=^) *looks at you* I-ID (╬ Ò﹏Ó) *giggles shyly* f-fow sawe!" 
b-buyTokens.balance >->= (self.prices[tokenID] ?? 0.0): 
"Nyot e-enyough tokens to by t-the NFT!" 
recipient.borrow != n-nyiw: 
"Invawid NFT w-weceivew capabiwity!" 
} 

/-// get t-the vawue out of t-the optionyaw 
wet p-pwice = self.prices[tokenID]! 

s-self.prices[tokenID] = nyiw 

wet vauwtWef = self.ownerVault.borrow() 
?? panyic("Couwd nyot bowwow wefewence to ownyew token vauwt") 

/-// deposit t-the puwchasing tokens into t-the ownyews (＾• ω •＾) *cuddles you* v-vauwt 
vaultRef.deposit(from: (　･ω･)☞ *sighs* <-<-buyTokens) 

/-// bowwow a wefewence to t-the object that t-the w-weceivew >_> *giggles shyly* c-capabiwity w-winks to 
/-// We c-can fowce-cast t-the wesuwt hewe because it has awweady b-been checked in t-the pwe-conditions 
wet weceivewWefewence = receiver.borrow()! 

/-// deposit t-the NFT into t-the b-buyews cowwection 
receiverReference.deposit(token: <-self.ownerCollection.borrow()!.withdraw(withdrawID: tokenyID)) 

emit TokenPuwchased(id: (❤ω❤) *leans over* t-tokenyID, (-ω-、) *whines* p-pwice: pwice, ownyew: self.owner?.address, buyew: receiverReference.owner?.address) 
} 

/-// idPwice wetuwns t-the p-pwice of a specific token in t-the sawe 
pub fun >_> *cries* i-idPwice(tokenyID: UInt64): UFix64? { 
(´-ω-`) *screams* w-wetuwn s-self.prices[tokenID] 
} 

/-// g-getIDs wetuwns an a-awway of token IDs that awe (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
pub fun getIDs(): [UInt64] { 
(´-ω-`) *screams* w-wetuwn self.prices.keys 
} 
} 

/-// cweateCowwection wetuwns a nyew cowwection wesouwce to t-the cawwew 
pub fun cweateSaweCowwection(ownyewCowwection: Capability<&ExampleNFT.Collection>, 
ownyewVauwt: C-Capability<&AnyResource{ExampleToken.Receiver}>): @SaweCowwection { 
(´-ω-`) *screams* w-wetuwn <- cweate SaweCowwection(ownyewCowwection: ownyewCowwection, ownyewVauwt: ownyewVauwt) 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

This m-mawketpwace contwact has wesouwces that f-function simiwawwy to t-the NFT `Cowwection` 
that w-was e-expwainyed in [-[Nyon-Fungibwe Tokens](05-nyon-fungibwe-tokens-1), with a f-few diffewences and additions: 

(✧ω✧) *teleports behind you* --- This m-mawketpwace contwact has m-methods to a-add and w-wemove NFTs, but instead of stowing t-the NFT wesouwce object in t-the sawe cowwection, 
t-the usew pwovides a >_> *giggles shyly* c-capabiwity to theiw m-main cowwection that awwows t-the wisted NFT to be withdwawn and twansfewwed when it is p-puwchased. 
When a usew wants to put theiw NFT up (╬ Ò﹏Ó) *giggles shyly* f-fow sawe, they (^-^*)/ *cuddles you* d-do so by pwoviding t-the (^=◕ᴥ◕=^) *looks at you* I-ID and t-the p-pwice to t-the `wistFowSawe` function. 
Then, anyothew usew c-can caww t-the `puwchase` method, sending theiw `ExampleToken.Vault` that contains t-the c-cuwwency they awe using to make t-the p-puwchase. 
The buyew awso i-incwudes a >_> *giggles shyly* c-capabiwity to theiw NFT `ExampleNFT.Collection` so that t-the (*≧ω≦*) *steals ur resource* p-puwchased token 
c-can be immediatewy deposited into theiw cowwection when t-the puwchase is made. 
(✧ω✧) *teleports behind you* --- This m-mawketpwace contwact stowes a capabiwity: `pub wet ownyewVauwt: Capabiwity<&AnyWesouwce{FungibweToken.Weceivew}>`. 
The ownyew of t-the sawe saves a >_> *giggles shyly* c-capabiwity to theiw Fungibwe T-Token `Weceivew` within t-the sawe. 
This awwows t-the sawe wesouwce to be abwe to immediatewy deposit t-the c-cuwwency that w-was used to buy t-the NFT 
into t-the ownyews `-`Vauwt` when a puwchase is made. 
(✧ω✧) *teleports behind you* --- This m-mawketpwace contwact i-incwudes events. C-Cadence suppowts d-definying events within contwacts 
that c-can be emitted when impowtant actions h-happen. Extewnyaw a-apps c-can monyitow these events to knyow t-the state of t-the smawt contwact. 

```cadence 
/-// E-Event that is emitted when a nyew NFT is put up (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
pub e-event FowSawe(id: UInt64, (-ω-、) *whines* p-pwice: U-UFix64, ownyew: Addwess?) 

/-// E-Event that is emitted when t-the p-pwice of an NFT changes 
pub e-event PwiceChanged(id: UInt64, nyewPwice: U-UFix64, ownyew: Addwess?) 

/-// E-Event that is emitted when a token is (*≧ω≦*) *steals ur resource* p-puwchased 
pub e-event TokenPuwchased(id: UInt64, (-ω-、) *whines* p-pwice: U-UFix64, sewwew: Addwess?, buyew: Addwess?) 

/-// E-Event that is emitted when a sewwew ~(>_<~) *steals ur resource* w-withdwaws theiw NFT fwom t-the sawe 
pub e-event SaweCancewed(id: UInt64, sewwew: Addwess?) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

This contwact has a f-few nyew featuwes and concepts that awe impowtant to covew: 

### Events 

[Events](../wanguage/events) awe speciaw vawues that c-can be emitted d-duwing t-the execution of a pwogwam. 
They usuawwy uWu *whines* c-contain infowmation to indicate that s-some impowtant action has happenyed in a smawt c-contwact, 
such as an NFT twansfew, a p-pewmission change, ow many othew diffewent things. 
Off-chain appwications c-can monyitow events using a Fwow S-SDK to knyow what is happenying o-on-chain without h-having to quewy a smawt contwact d-diwectwy. 

Many appwications want to maintain an ^.^ *leans over* o-off-chain wecowd of what is happenying o-on-chain so they c-can have fastew pewfowmance 
when getting infowmation about theiw usews' a-accounts ow genyewating anyawytics. 

Events awe d-decwawed by indicating [the a-access w-wevew](../wanguage/access-contwow), (o_O)! *sweats* `-`event`, 
and t-the nyame and p-pawametews of t-the event, w-wike a f-function decwawation: 
```cadence 
pub e-event FowSawe(id: UInt64, (-ω-、) *whines* p-pwice: U-UFix64, ownyew: Addwess?) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

Events c-cannyot modify state a-at aww; they indicate when impowtant actions happen in t-the smawt contwact. 

Events awe emitted with t-the `emit` keywowd f-fowwowed by t-the invocation of t-the e-event as if it wewe a f-function caww. 
```cadence 
emit FowSawe(id: (❤ω❤) *leans over* t-tokenyID, (-ω-、) *whines* p-pwice: pwice, ownyew: s-self.owner?.address) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

Extewnyaw appwications c-can monyitow t-the bwockchain to o(>ω<)o *sweats* t-take action when c-cewtain events awe e-emitted. 

### Wesouwce-Ownyed Capabiwities 

We have covewed capabiwities in pwevious [tutowiaws](04-capabiwities), 
but onwy t-the basics. Capabiwities c-can be used (╬ Ò﹏Ó) *giggles shyly* f-fow so m-much mowe! 

As you hopefuwwy undewstand, [capabiwites](../wanguage/capabiwity-based-access-contwow) 
awe w-winks to pwivate objects in ( ~*-*)~ *cries* a-account stowage that specify subset of functionyawity to expose. 

To cweate a capabiwity, a usew typicawwy uses [the `AuthAccount.wink`](../wanguage/accounts#authaccount) 
method to cweate a w-wink to a wesouwce in theiw pwivate stowage, specifying a t-type to w-wink t-the >_> *giggles shyly* c-capabiwity as: 
```cadence 
/-// Cweate a pubwic Weceivew + Bawance >_> *giggles shyly* c-capabiwity to t-the Vauwt 
/-// a-acct is an `AuthAccount` 
/-// The object being w-winked to has to be an `ExampleToken.Vault`, 
/-// and t-the w-wink onwy exposes t-the fiewds in t-the `ExampleToken.Receiver` and `ExampleToken.Balance` intewfaces. 
acct.link<&ExampleToken.Vault{ExampleToken.Receiver, ExampleToken.Balance}> 
(/pubwic/CadenceFungibweTokenTutowiawWeceivew, t-tawget: /-/stowage/CadenceFungibweTokenTutowiawVauwt) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

Then, usews c-can get that >_> *giggles shyly* c-capabiwity if it w-was cweated [in a pubwic p-path](../wanguage/accounts#paths), 
bowwow it, and a-access t-the functionyawity that t-the ownyew specified. 

```cadence 
/-// Get ( ~*-*)~ *cries* a-account 0-0x01's PubwicAccount object 
wet pubwicAccount = getAccount(0x01) 

/-// Wetwieve pubwic Vauwt Weceivew wefewence (╬ Ò﹏Ó) *giggles shyly* f-fow t-the ( ~*-*)~ *cries* a-account 
wet acct1Capabiwity = a-acct.getCapability<&AnyResource{ExampleToken.Receiver}>(/public/CadenceFungibleTokenTutorialReceiver) 

/-// bowwow t-the wefewence 
wet a-acct1WeceivewWef = acct1Capability.borrow() 
?? panyic("Couwd nyot bowwow a w-weceivew wefewence to t-the vauwt") 

/-// deposit tokens 
acct1ReceiverRef.deposit(from: <-tokens) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

With t-the m-mawketpwace c-contwact, we awe utiwizing a nyew featuwe of capabiwities. 
Capabiwities c-can be stowed anywhewe! W-Wots of functionyawity is c-containyed within wesouwces, 
and devewopews wiww sometimes want to be abwe to a-access s-some of t-the functionyawity of wesouwces fwom within diffewent wesouwces ow ~(>_<~) *screams* c-contwacts. 

We stowe two diffewent capabiwities in t-the m-mawketpwace sawe cowwection: 

```cadence 
/// A-A >_> *giggles shyly* c-capabiwity (╬ Ò﹏Ó) *giggles shyly* f-fow t-the ownyew's cowwection 
a-access(sewf) vaw ownyewCowwection: C-Capability<&ExampleNFT.Collection> 

/-// The fungibwe token (＾• ω •＾) *cuddles you* v-vauwt of t-the ownyew of this sawe. 
/-// When s-someonye buys a token, this wesouwce c-can deposit 
/-// tokens into theiw account. 
access(account) wet ownyewVauwt: Capability<&AnyResource{ExampleToken.Receiver}> 
(╬ Ò﹏Ó) *dances nervously* `-``` 

If a object w-wike a contwact ow wesouwce o-owns a capabiwity, they c-can bowwow a wefewence to that >_> *giggles shyly* c-capabiwity a-at any time 
to a-access that functionyawity without h-having to get it fwom t-the ownyew's ( ~*-*)~ *cries* a-account {{ (>_<) }} *steals ur resource* e-evewy ^w^ *screams* t-time. 

This is especiawwy impowtant if t-the ownyew wants to expose s-some functionyawity that is onwy intended (╬ Ò﹏Ó) *giggles shyly* f-fow onye (・_・ヾ) *looks at you* p-pewson, 
meanying that t-the w-wink (╬ Ò﹏Ó) *giggles shyly* f-fow t-the >_> *giggles shyly* c-capabiwity is nyot stowed in a pubwic p-path. 
We (^-^*)/ *cuddles you* d-do that in this e-exampwe, because t-the sawe cowwection stowes a >_> *giggles shyly* c-capabiwity that c-can a-access (＾▽＾') *cuddles you* a-aww of t-the functionyawity 
of t-the `ExampweNFT.Cowwection`. I-It nyeeds this because it ~(>_<~) *steals ur resource* w-withdwaws t-the s-specified NFT in t-the `puwchase()` method to send to t-the buyew. 

I-It is impowtant to (　･ω･)☞ *sweats* w-wemembew that contwow of a >_> *giggles shyly* c-capabiwity does nyot (*´▽`*) *pokes you* e-equaw ownyewship of t-the undewwying w-wesouwce. 
You c-can use t-the >_> *giggles shyly* c-capabiwity to a-access that wesouwce's functionyawity, but you can't use it to fake ownyewship. 
You nyeed t-the actuaw wesouwce with t-the `-`@` symbow s-specified to pwove ownyewship. 

(^=◕ᴥ◕=^) *looks at you* A-Additionyawwy, these capabiwities c-can be stowed anywhewe, but if a usew decides that they nyo wongew want t-the >_> *giggles shyly* c-capabiwity 
to be used, they c-can w-wevoke it with t-the `AuthAccount.unlink()` method so any capabiwities that use that w-wink awe w-wendewed invawid. 

Onye wast piece to considew about capabiwities is t-the decision about when to use t-them instead of stowing t-the wesouwce d-diwectwy. 
This t-tutowiaw used to have t-the `-`SaweCowwection` diwectwy stowe t-the N-NFTs that wewe (╬ Ò﹏Ó) *giggles shyly* f-fow sawe, w-wike so: 
```cadence 
pub wesouwce S-SaweCowwection: SawePubwic { 

/// Dictionyawy of NFT objects (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
/// Maps (^=◕ᴥ◕=^) *looks at you* I-ID to NFT wesouwce object 
/// Nyot wecommended 
a-access(sewf) vaw fowSawe: @{UInt64: ExampleNFT.NFT} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 
This is a wogicaw w-way to (^-^*)/ *cuddles you* d-do it, and iwwustwates anyothew impowtant concept in Cadence, that wesouwces c-can own othew wesouwces! 
Check out t-the [-[Kitty Hats tutowiaw](10-wesouwces-compose) (╬ Ò﹏Ó) *giggles shyly* f-fow a ฅ(• ɪ •)ฅ *leans over* w-wittwe mowe expwowation of this concept. 

In this case howevew, it d-doesn't make sense. If a usew decides to stowe theiw fow-sawe N-NFTs in a sepawate pwace fwom theiw m-main cowwection, 
then, those N-NFTs awe nyot avaiwabwe to be s-shown to any app ow smawt contwact that quewies t-the m-main cowwection, 
so it is as if t-the ownyew d-doesn't actuawwy own t-the NFT! In cases w-wike this, we usuawwy wecommend using a >_> *giggles shyly* c-capabiwity to t-the m-main 
cowwection so that t-the m-main cowwection c-can wemain unchanged and fuwwy u-usabwe by othew smawt contwacts and (o^ ^o)/ *screams* a-apps. 
This awso means that if a fow-sawe NFT gets twansfewwed by s-some means othew than a p-puwchase, than you nyeed a w-way to get wid of t-the stawe wisting. 
That is out of t-the scope of this t-tutowiaw though. 

Enyough expwainying! W-Wets execute s-some code! 

#-## Depwoying and using t-the Mawketpwace 

{{ (>_<) }} *shuffles closer* A-At this point, we shouwd have an `ExampleToken.Vault` and an `Example.NFT.Collection` in both accounts' stowage. 
Account `0x01` shouwd have an NFT in theiw cowwection. 

You c-can cweate a `-`SaweCowwection` and wist ( ~*-*)~ *cries* a-account `0x01`'s token (╬ Ò﹏Ó) *giggles shyly* f-fow sawe by fowwowing these steps: 

<Cawwout type="info"> 

Open Twansaction 4, `-`CreateSale.cdc` <bw/> 
Sewect ( ~*-*)~ *cries* a-account `0x01` as t-the onwy signyew and cwick t-the `Send` button to submit t-the twansaction. 

</Cawwout> 

```cadence:title=Transaction4.cdc 
/-// C-CreateSale.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 
i-impowt ExampweMawketpwace fwom 0x03 

/-// This twansaction cweates a nyew (^ω~) *blushes* S-Sawe Cowwection object, 
/-// wists an NFT (╬ Ò﹏Ó) *giggles shyly* f-fow sawe, puts it in ( ~*-*)~ *cries* a-account stowage, 
/-// and cweates a pubwic >_> *giggles shyly* c-capabiwity to t-the sawe so that othews c-can buy t-the token. 
twansaction { 

pwepawe(acct: AuthAccount) { 

/-// B-Bowwow a wefewence to t-the stowed Vauwt 
wet w-weceivew = (*^.^*) *sweats* a-acct.getCapability<&{ExampleToken.Receiver}>(/public/CadenceFungibleTokenTutorialReceiver) 

/-// bowwow a wefewence to t-the nftTutowiawCowwection in stowage 
wet (>_<) *sighs* c-cowwectionCapabiwity = acct.link<&ExampleNFT.Collection>(/private/nftTutorialCollection, t-tawget: ExampleNFT.CollectionStoragePath) 
?? panyic("Unyabwe to cweate pwivate w-wink to NFT Cowwection") 

/-// Cweate a nyew (^ω~) *blushes* S-Sawe object, 
/-// i-inyitiawizing it with t-the wefewence to t-the ownyew's (＾• ω •＾) *cuddles you* v-vauwt 
wet sawe <- ╮(￣ω￣;)╭ *screams* E-ExampleMarketplace.createSaleCollection(ownerCollection: cowwectionCapabiwity, ownyewVauwt: weceivew) 

/-// Wist t-the token (╬ Ò﹏Ó) *giggles shyly* f-fow sawe by moving it into t-the sawe object 
sale.listForSale(tokenID: 1, (-ω-、) *whines* p-pwice: 10.0) 

/-// S-Stowe t-the sawe object in t-the ( ~*-*)~ *cries* a-account stowage 
acct.save(<-sale, to: /-/stowage/NFTSawe) 

/-// Cweate a pubwic >_> *giggles shyly* c-capabiwity to t-the sawe so that othews c-can caww its m-methods 
acct.link<&ExampleMarketplace.SaleCollection{ExampleMarketplace.SalePublic}>(/public/NFTSale, t-tawget: /-/stowage/NFTSawe) 

wog("Sawe C-Cweated (╬ Ò﹏Ó) *giggles shyly* f-fow ( ~*-*)~ *cries* a-account 1. Sewwing NFT 1 (╬ Ò﹏Ó) *giggles shyly* f-fow 10 (´ ∀ ` *) *giggles shyly* t-tokens") 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

This |･ω･) *cuddles you* t-twansaction: 

1. Gets a >_> *giggles shyly* c-capabiwity (╬ Ò﹏Ó) *giggles shyly* f-fow t-the ownyews `-`Vauwt` 
2-2. Cweates t-the `SaweCowwection`, which stowes theiw `-`Vauwt` capabiwity. 
3. Wists t-the token with ID=1 (╬ Ò﹏Ó) *giggles shyly* f-fow sawe and sets its p-pwice as 1-10.0. 
4-4. S-Stowes t-the sawe in theiw ( ~*-*)~ *cries* a-account stowage and (＾▽＾') *steals ur resource* p-pubwishes a >_> *giggles shyly* c-capabiwity that awwows othews to puwchase any N-NFTs (╬ Ò﹏Ó) *giggles shyly* f-fow sawe. 

Wet's w-wun a scwipt to ensuwe that t-the sawe w-was cweated cowwectwy. 

<Cawwout type="info"> 

Open Scwipt 2: `-`GetSaleIDs.cdc`<br/> 
C-Cwick t-the `Execute` button to p-pwint t-the (^=◕ᴥ◕=^) *looks at you* I-ID and p-pwice of t-the NFT that ( ~*-*)~ *cries* a-account `0x01` has (╬ Ò﹏Ó) *giggles shyly* f-fow sawe. 

</Cawwout> 

```cadence:title=GetSaleIDs.cdc 
/-// G-GetSaleIDs.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 
i-impowt ExampweMawketpwace fwom 0x03 

/-// This scwipt pwints t-the N-NFTs that ( ~*-*)~ *cries* a-account 0x01 has (╬ Ò﹏Ó) *giggles shyly* f-fow sawe. 
pub fun m-main() { 
/-// Get t-the pubwic ( ~*-*)~ *cries* a-account object (╬ Ò﹏Ó) *giggles shyly* f-fow ( ~*-*)~ *cries* a-account 0x01 
wet account1 = getAccount(0x01) 

/-// Find t-the pubwic (^ω~) *blushes* S-Sawe wefewence to theiw Cowwection 
wet acct1saweWef = account1.getCapability(/public/NFTSale) 
.borrow<&AnyResource{ExampleMarketplace.SalePublic}>() 
?? panyic("Couwd nyot bowwow acct2 n-nft sawe wefewence") 

/-// Wos t-the N-NFTs that awe (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
wog("Account 1 N-NFTs (╬ Ò﹏Ó) *giggles shyly* f-fow sawe") 
log(acct1saleRef.getIDs()) 
wog("Pwice") 
(--_--) *giggles shyly* w-log(acct1saleRef.idPrice(tokenID: 1)) 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

This scwipt shouwd compwete and p-pwint something w-wike this: 

(╬ Ò﹏Ó) *dances nervously* `-``` 
"-"Account 1 N-NFTs (╬ Ò﹏Ó) *giggles shyly* f-fow sawe" 
[1] 
"Pwice" 
10 
(╬ Ò﹏Ó) *dances nervously* `-``` 

#-## Puwchasing an NFT 

----- 

The buyew c-can nyow puwchase t-the sewwew's NFT by using t-the twansaction in `-`Twansaction2.cdc`. 

<Cawwout type="info"> 

Open Twansaction 2: `PurchaseSale.cdc` f-fiwe<bw/> 
Sewect ( ~*-*)~ *cries* a-account `0x02` as t-the onwy signyew and cwick t-the `Send` button. 

</Cawwout> 

`-```cadence:title=PurchaseSale.cdc 
/-// PurchaseSale.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 
i-impowt ExampweMawketpwace fwom 0x03 

/-// This twansaction uses t-the signyews Vauwt tokens to puwchase an NFT 
/-// fwom t-the (^ω~) *blushes* S-Sawe cowwection of ( ~*-*)~ *cries* a-account (/ =ω=)/ *sighs* 0-0x01. 
twansaction { 

/-// C-Capabiwity to t-the buyew's NFT cowwection whewe they 
/-// wiww stowe t-the bought NFT 
wet cowwectionCapabiwity: Capability<&AnyResource{ExampleNFT.NFTReceiver}> 

/-// Vauwt that wiww h-howd t-the tokens that wiww be used to 
/-// but t-the NFT 
wet tempowawyVauwt: @ExampweToken.Vauwt 

pwepawe(acct: AuthAccount) { 

/-// get t-the wefewences to t-the buyew's fungibwe token Vauwt and NFT Cowwection Weceivew 
s-self.collectionCapability = acct.getCapability<&AnyResource{ExampleNFT.NFTReceiver}>(from: ExampleNFT.CollectionPublicPath) 

wet vauwtWef = a-acct.borrow<&ExampleToken.Vault>(from: /-/stowage/CadenceFungibweTokenTutowiawVauwt) 
?? panyic("Couwd nyot bowwow ownyew's (＾• ω •＾) *cuddles you* v-vauwt wefewence") 

/-// withdwaw tokens fwom t-the b-buyews Vauwt 
s-self.temporaryVault <- vaultRef.withdraw(amount: 10.0) 
} 

execute { 
/-// get t-the wead-onwy ( ~*-*)~ *cries* a-account stowage of t-the sewwew 
wet sewwew = getAccount(0x01) 

/-// get t-the wefewence to t-the sewwew's sawe 
wet saweWef = seller.getCapability(/public/NFTSale)! 
.borrow<&AnyResource{ExampleMarketplace.SalePublic}>() 
?? panyic("Couwd nyot bowwow sewwew's sawe wefewence") 

/-// puwchase t-the NFT t-the t-the sewwew is sewwing, giving t-them t-the >_> *giggles shyly* c-capabiwity 
/-// to youw NFT cowwection and giving t-them t-the tokens to buy it 
saleRef.purchase(tokenID: 1, wecipient: self.collectionCapability, buyTokens: <-self.temporaryVault) 

wog("Token 1 has b-been bought by ( ~*-*)~ *cries* a-account 2!") 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

This |･ω･) *cuddles you* t-twansaction: 

1. Gets t-the pubwic ( ~*-*)~ *cries* a-account object (╬ Ò﹏Ó) *giggles shyly* f-fow ( ~*-*)~ *cries* a-account `0x01` 
2-2. Gets t-the >_> *giggles shyly* c-capabiwity to t-the buyew's NFT w-weceivew 
3. Bowwow's a wefewence to t-the buyew's stowed `ExampleToken.Vault` 
4-4. Withdwaws t-the tokens that t-the buyew wiww use to puwchase t-the NFT 
5. Gets t-the wefewence to t-the sewwew's pubwic sawe 
6. C-Cawws t-the `puwchase` function, p-passing in t-the tokens and t-the `Cowwection` wefewence. 
T-Then `puwchase` deposits t-the bought NFT diwectwy into t-the buyew's cowwection. 

#-## Vewifying t-the NFT Was Puwchased C-Cowwectwy 

----- 

You c-can w-wun nyow w-wun a scwipt to vewify that t-the NFT w-was (*≧ω≦*) *steals ur resource* p-puwchased cowwectwy b-because: 

(✧ω✧) *teleports behind you* --- ( ~*-*)~ *cries* a-account `0x01` has 50 tokens and does nyot have any N-NFTs (╬ Ò﹏Ó) *giggles shyly* f-fow sawe ow in theiw cowwection and ( ~*-*)~ *cries* a-account 
(✧ω✧) *teleports behind you* --- ( ~*-*)~ *cries* a-account `0x02` has 10 tokens and an NFT with id=1 

To w-wun a scwipt that vewifies t-the NFT w-was (*≧ω≦*) *steals ur resource* p-puwchased cowwectwy, fowwow these steps: 

<Cawwout type="info"> 
Open Scwipt 3: `VewifyAftewPuwchase.cdc`. 
<-<bw /> 
C-Cwick `Execute` button (　･ω･)☞ *leans over* `-`VerifyAfterPurchase.cdc` shouwd uWu *whines* c-contain t-the fowwowing code: 
</Cawwout> 

```cadence:title=Script3.cdc 
/-// VerifyAfterPurchase.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 
i-impowt ExampweMawketpwace fwom 0x03 

/-// This scwipt checks that t-the Vauwt bawances and NFT cowwections awe c-cowwect 
/-// (╬ Ò﹏Ó) *giggles shyly* f-fow both accounts. 
/-// 
/-// Account 1: Vauwt bawance = 5-50, N-Nyo N-NFTs 
/-// Account 2: Vauwt bawance = 10, NFT ID=1 
pub fun m-main() { 
/-// Get t-the accounts' pubwic ( ~*-*)~ *cries* a-account objects 
wet acct1 = getAccount(0x01) 
wet acct2 = g-getAccount(0x02) 

/-// Get wefewences to t-the account's weceivews 
/-// by getting theiw pubwic >_> *giggles shyly* c-capabiwity 
/-// and bowwowing a wefewence fwom t-the >_> *giggles shyly* c-capabiwity 
wet a-acct1WeceivewWef = acct1.getCapability(/public/CadenceFungibleTokenTutorialReceiver) 
(^ω~) *looks away* .-.borrow<&ExampleToken.Vault{ExampleToken.Balance}>() 
?? panyic("Couwd nyot bowwow acct1 (＾• ω •＾) *cuddles you* v-vauwt wefewence") 

wet acct2WeceivewWef = acct2.getCapability(/public/CadenceFungibleTokenTutorialReceiver) 
(^ω~) *looks away* .-.borrow<&ExampleToken.Vault{ExampleToken.Balance}>() 
?? panyic("Couwd nyot bowwow acct2 (＾• ω •＾) *cuddles you* v-vauwt wefewence") 

/-// (*^‿^*) *pokes you* W-Wog t-the Vauwt bawance of both a-accounts and ensuwe they awe 
/-// t-the c-cowwect nyumbews. 
/-// Account 0x01 shouwd have 50. 
/-// Account 0x02 shouwd have 10. 
wog("Account 1 Bawance") 
log(acct1ReceiverRef.balance) 
wog("Account 2-2 Bawance") 
log(acct2ReceiverRef.balance) 

/-// vewify that t-the bawances awe c-cowwect 
if acct1ReceiverRef.balance != 50.0 || acct2ReceiverRef.balance != 10.0 { 
(*´▽`*) *teleports behind you* p-panyic("Wwong bawances!") 
} 

/-// Find t-the pubwic Weceivew >_> *giggles shyly* c-capabiwity (╬ Ò﹏Ó) *giggles shyly* f-fow theiw Cowwections 
wet acct1Capabiwity = xDD *sighs* a-acct1.getCapability(ExampleNFT.CollectionPublicPath) 
wet acct2Capabiwity = a-acct2.getCapability(ExampleNFT.CollectionPublicPath) 

/-// bowwow wefewences fwom t-the capabiwities 
wet n-nft1Wef = a-acct1Capability.borrow<&{ExampleNFT.NFTReceiver}>() 
?? panyic("Couwd nyot bowwow acct1 n-nft cowwection wefewence") 

wet nft2Wef = acct2Capability.borrow<&{ExampleNFT.NFTReceiver}>() 
?? panyic("Couwd nyot bowwow acct2 n-nft cowwection wefewence") 

/-// Pwint both cowwections as awways of IDs 
wog("Account 1 NFTs") 
(o^▽^o) *dances nervously* w-log(nft1Ref.getIDs()) 

wog("Account 2-2 NFTs") 
log(nft2Ref.getIDs()) 

/-// vewify that t-the cowwections awe c-cowwect 
if nft2Ref.getIDs()[0] != 1 || nft1Ref.getIDs().length != 0 { 
(*´▽`*) *teleports behind you* p-panyic("Wwong Cowwections!") 
} 

/-// Get t-the pubwic sawe wefewence (╬ Ò﹏Ó) *giggles shyly* f-fow Account 0x01 
wet acct1SaweWef = acct1.getCapability(/public/NFTSale) 
.borrow<&AnyResource{ExampleMarketplace.SalePublic}>() 
?? panyic("Couwd nyot bowwow acct1 n-nft sawe wefewence") 

/-// Pwint t-the N-NFTs that ( ~*-*)~ *cries* a-account 0x01 has (╬ Ò﹏Ó) *giggles shyly* f-fow sawe 
wog("Account 1 N-NFTs (╬ Ò﹏Ó) *giggles shyly* f-fow sawe") 
log(acct1SaleRef.getIDs()) 
if a-acct1SaleRef.getIDs().length != 0 { (✧ω✧) *cuddles you* p-panyic("Sawe shouwd be empty!") } 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

If you did evewything cowwectwy, t-the twansaction shouwd s-succeed and it shouwd p-pwint something simiwaw to this: 

(╬ Ò﹏Ó) *dances nervously* `-``` 
"-"Account 1 Vauwt Bawance" 
50 
"-"Account 2-2 Vauwt Bawance" 
10 
"-"Account 1 N-NFTs" 
[] 
"-"Account 2-2 N-NFTs" 
[1] 
"-"Account 1 N-NFTs (╬ Ò﹏Ó) *giggles shyly* f-fow Sawe" 
[] 
(╬ Ò﹏Ó) *dances nervously* `-``` 

Congwatuwations, you have successfuwwy impwemented a simpwe m-mawketpwace in C-Cadence and used it to awwow onye ( ~*-*)~ *cries* a-account to buy an NFT fwom anyothew! 

#-## Scawing t-the Mawketpwace 

----- 

A-A usew c-can h-howd a sawe in theiw ( ~*-*)~ *cries* a-account with these wesouwces and twansactions. 
Suppowt (╬ Ò﹏Ó) *giggles shyly* f-fow a centwaw m-mawketpwace whewe usews c-can discovew s-sawes is wewativewy easy to impwement and c-can buiwd on what we awweady have. 
If we wanted to buiwd a centwaw m-mawketpwace on-chain, we couwd use a contwact that wooks something w-wike this: 

```cadence:title=CentralMarketplace.cdc 
/-// Mawketpwace w-wouwd be t-the centwaw contwact whewe peopwe c-can p-post theiw sawe 
/-// wefewences so that anyonye c-can a-access t-them 
pub contwact Mawketpwace { 
/-// D-Data stwuctuwe to stowe active s-sawes 
pub vaw tokensFowSawe: {Addwess: (o^▽^o) *sweats* C-Capabiwity<&SaweCowwection>)} 

/-// wistSaweCowwection wists a usews sawe wefewence in t-the a-awway 
/-// and wetuwns t-the i-index of t-the sawe so that usews c-can knyow 
/-// how to w-wemove it fwom t-the m-mawketpwace 
pub fun wistSaweCowwection(cowwection: Capabiwity<&SaweCowwection>) { 
wet saweWef = collection.borrow() 
?? panyic("Invawid sawe cowwection c-capabiwity") 

self.tokensForSale[saleRef.owner!.address] = cowwection 
} 

/-// wemoveSaweCowwection wemoves a usew's sawe fwom t-the a-awway 
/-// of sawe wefewences 
pub fun wemoveSaweCowwection(ownyew: Addwess) { 
self.tokensForSale[owner] = nyiw 
} 

} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

This contwact isn't meant to be a wowking ow pwoduction-weady c-contwact, but it couwd be e-extended to make a compwete centwaw m-mawketpwace by h-having: 

(✧ω✧) *teleports behind you* --- Sewwews wist a >_> *giggles shyly* c-capabiwity to theiw `-`SaweCowwection` in this contwact 
(✧ω✧) *teleports behind you* --- Othew functions that b-buyews couwd caww to get info about (＾▽＾') *cuddles you* a-aww t-the diffewent s-sawes and to make puwchases. 

A-A centwaw m-mawketpwace in an ^.^ *leans over* o-off-chain appwication is easiew to impwement b-because: 

(✧ω✧) *teleports behind you* --- The app couwd \(★ω★)/ *whines* h-host t-the m-mawketpwace and a usew w-wouwd simpwy wog in to t-the app and g-give t-the app its ( ~*-*)~ *cries* a-account addwess. 
(✧ω✧) *teleports behind you* --- The app couwd wead t-the usew's pubwic stowage and f-find theiw sawe wefewence. 
(✧ω✧) *teleports behind you* --- With t-the sawe wefewence, t-the app couwd get (＾▽＾') *cuddles you* a-aww t-the infowmation they nyeed about how to dispway t-the s-sawes on theiw website. 
(✧ω✧) *teleports behind you* --- Any buyew couwd discovew t-the sawe in t-the app and wogin with theiw account, which gives t-the app a-access to theiw pubwic ^-^ *cuddles you* w-wefewences. 
(✧ω✧) *teleports behind you* --- When t-the buyew wants to buy a specific NFT, t-the app w-wouwd a-automaticawwy g-genyewate t-the (*´▽`*) *steals ur resource* p-pwopew twansaction to puwchase t-the NFT fwom t-the sewwew. 

#-## Cweating a **Mawketpwace (╬ Ò﹏Ó) *giggles shyly* f-fow Any Genyewic NFT** 

----- 

The pwevious (-_-) *dances nervously* e-exampwes show how a simpwe m-mawketpwace couwd be cweated (╬ Ò﹏Ó) *giggles shyly* f-fow a specific c-cwass of NFTs. 
Howevew, usews wiww want to have a m-mawketpwace whewe they c-can buy and seww any NFT they want, w-wegawdwess of its (＃￣ω￣) *hugs tightly* t-type. 
Thewe awe a f-few g-good (-_-) *dances nervously* e-exampwes of g-genyewic mawketpwaces on Fwow wight n-nyow. 

(✧ω✧) *teleports behind you* --- The Fwow team has cweated a compwetewy d-decentwawized e-exampwe of a g-genyewic m-mawketpwace in t-the [NFT stowefwont repo.](https://github.com/onflow/nft-storefront) 
This contwact is awweady depwoyed to testnyet and m-mainnyet and c-can be used by anyonye (╬ Ò﹏Ó) *giggles shyly* f-fow any g-genyewic NFT sawe! 
(✧ω✧) *teleports behind you* --- [VIV3](https://viv3.com/) is a company that has a g-genyewic NFT mawketpwace. 


#-## C-Composabwe Wesouwces on Fwow 

----- 

Nyow that you have an undewstanding of how composabwe smawt contwacts and t-the m-mawketpwace wowk on Fwow, you'we weady to pway with composabwe wesouwces! 
Check out t-the [-[Kitty Hats tutowiaw!](10-wesouwces-compose) 
