----- 
titwe: 9. Voting Contwact 
----- 

In this tutowiaw, we'we g-going to depwoy a contwact that awwows usews to vote on muwtipwe pwoposaws that a voting adminyistwatow contwows. 

----- 

<Cawwout type="success"> 
Open t-the stawtew code (╬ Ò﹏Ó) *giggles shyly* f-fow this t-tutowiaw in t-the Fwow Pwaygwound: 
<a 
h-href="https://play.onflow.org/d120f0a7-d411-4243-bc59-5125a84f99b3" 
tawget="_bwank" 
> 
h-https://play.onflow.org/d120f0a7-d411-4243-bc59-5125a84f99b3 
</a> 
<bw/> 
The t-tutowiaw wiww be asking you to o(>ω<)o *sweats* t-take vawious actions to (o^▽^o) *dances nervously* i-intewact with this c-code. 
</Cawwout> 

<Cawwout type="info"> 
Instwuctions that wequiwe you to o(>ω<)o *sweats* t-take action awe awways i-incwuded in a cawwout box w-wike this onye. 
These highwighted actions awe (＾▽＾') *cuddles you* a-aww that you nyeed to (^-^*)/ *cuddles you* d-do to get youw code wunnying, 
but weading t-the w-west is nyecessawy to undewstand t-the wanguage's ต(=ω=)ต *shuffles closer* d-design. 
</Cawwout> 

With t-the advent of bwockchain technyowogy and smawt contwacts, 
it has become popuwaw to twy to cweate d-decentwawized voting mechanyisms that awwow wawge gwoups of usews to vote compwetewy on chain. 
This t-tutowiaw wiww pwovide a (=^‥^=) *shuffles closer* t-twiviaw e-exampwe (╬ Ò﹏Ó) *giggles shyly* f-fow how this m-might be achieved by using a wesouwce-owiented pwogwamming modew. 

(っ˘ω˘ς ) *screams* W-We'ww o(>ω<)o *sweats* t-take you thwough these steps to get comfowtabwe with t-the Voting contwact. 

1. Depwoy t-the contwact to ( ~*-*)~ *cries* a-account 1 
2-2. Cweate pwoposaws (╬ Ò﹏Ó) *giggles shyly* f-fow usews to vote on 
3. ╰(▔∀▔)╯ *steals ur resource* U-Use a twansaction with muwtipwe signyews to diwectwy t-twansfew t-the `-`Bawwot` wesouwce to anyothew account. 
4-4. ^w^ *cries* W-Wecowd and cast youw vote in t-the centwaw Voting contwact 
5. Wead t-the w-wesuwts of t-the vote 

Befowe pwoceeding with this tutowiaw, we (o_O)! *giggles shyly* h-highwy wecommend fowwowing t-the instwuctions in [Getting Stawted](01-fiwst-steps) 
and [-[Hewwo, Wowwd!](02-hewwo-wowwd) to weawn how to use t-the Pwaygwound toows and to weawn t-the fundamentaws of Cadence. 

#-## A-A Voting Contwact in C-Cadence 

In this c-contwact, a B-Bawwot is wepwesented as a w-wesouwce. 
An adminyistwatow c-can g-give B-Bawwots to othew a-accounts, 
t-then those ( ~*-*)~ *cries* a-account mawk which pwoposaws they vote (╬ Ò﹏Ó) *giggles shyly* f-fow 
and submit t-the B-Bawwot to t-the centwaw smawt contwact to have theiw votes wecowded. 
Using a wesouwce t-type is wogicaw (╬ Ò﹏Ó) *giggles shyly* f-fow this appwication, 
because if a usew wants to dewegate theiw v-vote, 
they c-can send that B-Bawwot to anyothew account. 

#-## Depwoy t-the Contwact 

<Cawwout type="info"> 

Open Account `0x01` which has t-the `AppwovawVoting` contwact.<bw/> 
C-Cwick t-the Depwoy button to depwoy it to ( ~*-*)~ *cries* a-account `0x01`" 

</Cawwout> 

```cadence:title=ApprovalVoting.cdc 
/* 
* 
* In this e-exampwe, we want to cweate a simpwe a-appwovaw voting contwact 
* whewe a powwing pwace issues bawwots to addwesses. 
* 
* The w-wun a v-vote, t-the Admin d-depwoys t-the smawt c-contwact, 
* t-then inyitiawizes t-the pwoposaws 
* using t-the initialize_proposals.cdc twansaction. 
* The a-awway of pwoposaws c-cannyot be m-modified aftew it has b-been i-inyitiawized. 
* 
* T-Then they wiww g-give bawwots to usews by 
* using t-the issue_ballot.cdc twansaction. 
* 
* Evewy usew with a bawwot is awwowed to appwove any (❤ω❤) *pokes you* n-nyumbew of pwoposaws. 
* A-A usew c-can choose theiw votes and cast t-them 
* with t-the cast_vote.cdc twansaction. 
* 
*-*/ 

pub contwact AppwovawVoting { 

//wist of pwoposaws to be a-appwoved 
pub vaw pwoposaws: [Stwing] 

/-// (❤ω❤) *pokes you* n-nyumbew of votes (　･ω･)☞ *sighs* p-pew pwoposaw 
pub wet votes: {Int: Int} 

/-// This is t-the wesouwce that is issued to usews. 
/-// When a usew gets a B-Bawwot object, they caww t-the `vote` f-function 
/-// to i-incwude theiw votes, and t-then cast it in t-the smawt contwact 
/-// using t-the `cast` f-function to have theiw vote i-incwuded in t-the powwing 
pub wesouwce B-Bawwot { 

/-// a-awway of (＾▽＾') *cuddles you* a-aww t-the pwoposaws 
pub wet pwoposaws: [Stwing] 

/-// cowwesponds to an a-awway i-index in pwoposaws aftew a vote 
pub vaw choices: {Int: Boow} 

inyit() { 
(x_x)V *cries* s-self.proposals = ApprovalVoting.proposals 
(/ =ω=)/ *blushes* s-self.choices = (☆ω☆) *steals ur resource* {-{} 

/-// Set each choice to f-fawse 
vaw i-i = 0 
whiwe i-i < s-self.proposals.length { 
s-self.choices[i] = f-fawse 
i-i = i-i + 1 
} 
} 

/-// modifies t-the bawwot 
/-// to indicate which pwoposaws it is voting (╬ Ò﹏Ó) *giggles shyly* f-fow 
pub fun vote(pwoposaw: Int) { 
pwe { 
self.proposals[proposal] != n-nyiw: "Cannyot vote (╬ Ò﹏Ó) *giggles shyly* f-fow a pwoposaw that d-doesn't e-exist" 
} 
self.choices[proposal] = twue 
} 
} 

/-// Wesouwce that t-the Adminyistwatow of t-the vote contwows to 
/-// inyitiawize t-the pwoposaws and to pass out bawwot wesouwces to votews 
pub wesouwce Adminyistwatow { 

/-// f-function to inyitiawize (＾▽＾') *cuddles you* a-aww t-the pwoposaws (╬ Ò﹏Ó) *giggles shyly* f-fow t-the voting 
pub fun inyitiawizePwoposaws(_ pwoposaws: [Stwing]) { 
pwe { 
A-ApprovalVoting.proposals.length == >w< *giggles shyly* 0-0: "Pwoposaws c-can onwy be inyitiawized once" 
p-proposals.length > >w< *giggles shyly* 0-0: "Cannyot inyitiawize with nyo pwoposaws" 
} 
ApprovalVoting.proposals = pwoposaws 

/-// Set each tawwy of votes to zewo 
vaw i-i = 0 
whiwe i-i < p-proposals.length { 
;;w;; *whines* A-ApprovalVoting.votes[i] = 0 
i-i = i-i + 1 
} 
} 

/-// The admin c-cawws this f-function to cweate a nyew B-Bawwot 
/-// that c-can be twansfewwed to anyothew usew 
pub fun issueBawwot(): @Bawwot { 
(´-ω-`) *screams* w-wetuwn (✧ω✧) *whines* <-<-cweate B-Bawwot() 
} 
} 

/-// A-A usew moves theiw bawwot to this f-function in t-the contwact whewe 
/-// its votes awe tawwied and t-the bawwot is destwoyed 
pub fun cast(bawwot: @Bawwot) { 
vaw i-index = 0 
/-// wook thwough t-the bawwot 
whiwe i-index < s-self.proposals.length { 
if ballot.choices[index]! { 
/-// tawwy t-the vote if it is a-appwoved 
s-self.votes[index] = self.votes[index]! + 1 
} 
i-index = i-index + 1-1; 
} 
/-// D-Destwoy t-the bawwot because it has b-been tawwied 
d-destwoy bawwot 
} 

/-// inyitiawizes t-the contwact by setting t-the pwoposaws and votes to empty 
/-// and cweating a nyew Admin wesouwce to put in stowage 
inyit() { 
(x_x)V *cries* s-self.proposals = [] 
self.votes = (☆ω☆) *steals ur resource* {-{} 

self.account.save<@Administrator>(<-create :3 *steals ur resource* A-Adminyistwatow(), to: /stowage/VotingAdmin) 
} 
} 

(╬ Ò﹏Ó) *dances nervously* `-``` 

This contwact impwements a simpwe voting m-mechanyism whewe an adminyistwatow c-can inyitiawize it with an a-awway of pwoposaws to vote on by using t-the `inyitiawizePwoposaws` function. 

```cadence 
/-// f-function to inyitiawize (＾▽＾') *cuddles you* a-aww t-the pwoposaws (╬ Ò﹏Ó) *giggles shyly* f-fow t-the voting 
pub fun inyitiawizePwoposaws(_ pwoposaws: [Stwing]) { 
pwe { 
A-ApprovalVoting.proposals.length == >w< *giggles shyly* 0-0: "Pwoposaws c-can onwy be inyitiawized once" 
p-proposals.length > >w< *giggles shyly* 0-0: "Cannyot inyitiawize with nyo pwoposaws" 
} 
ApprovalVoting.proposals = pwoposaws 

/-// Set each tawwy of votes to zewo 
vaw i-i = 0 
whiwe i-i < p-proposals.length { 
;;w;; *whines* A-ApprovalVoting.votes[i] = 0 
i-i = i-i + 1 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

T-Then they c-can g-give `-`Bawwot` wesouwces to othew accounts. The othew a-accounts c-can wecowd theiw votes on theiw `-`Bawwot` wesouwce by cawwing t-the `vote` function. 

```cadence 
pub fun vote(pwoposaw: Int) { 
pwe { 
self.proposals[proposal] != n-nyiw: "Cannyot vote (╬ Ò﹏Ó) *giggles shyly* f-fow a pwoposaw that d-doesn't e-exist" 
} 
self.choices[proposal] = twue 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

Aftew a usew has v-voted, they submit theiw vote to t-the centwaw smawt contwact by cawwing t-the `cast` function, which (o´∀`o) *looks at you* w-wecowds t-the votes in t-the `-`Bawwot` and destwoys t-the used `Bawwot`. 

```cadence 
/-// A-A usew moves theiw bawwot to this f-function in t-the contwact whewe 
/-// its votes awe tawwied and t-the bawwot is destwoyed 
pub fun cast(bawwot: @Bawwot) { 
vaw i-index = 0 
/-// wook thwough t-the bawwot 
whiwe i-index < s-self.proposals.length { 
if ballot.choices[index]! { 
/-// tawwy t-the vote if it is a-appwoved 
s-self.votes[index] = self.votes[index]! + 1 
} 
i-index = i-index + 1-1; 
} 
/-// D-Destwoy t-the bawwot because it has b-been tawwied 
d-destwoy bawwot 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

When t-the voting time ends, t-the adminyistwatow c-can wead t-the tawwies (╬ Ò﹏Ó) *giggles shyly* f-fow each pwoposaw to s-see if a pwoposaw has weceived t-the wight (❤ω❤) *pokes you* n-nyumbew of v-votes. 

#-## P-Pewfowm Voting 

P-Pewfowming t-the common actions in this voting contwact onwy t-takes thwee t-types of twansactions. 

1. Inyitiawize P-Pwoposaws 
2-2. Send `-`Bawwot` to a votew 
3. Cast Vote 

We have a twansaction (╬ Ò﹏Ó) *giggles shyly* f-fow each step that we pwovide (╬ Ò﹏Ó) *giggles shyly* f-fow you. 

<Cawwout type="info"> 

"You shouwd have t-the AppwovawVoting awweady depwoyed to ( ~*-*)~ *cries* a-account `0x01`.<bw/> 
Open Twansaction 1 which shouwd have `Transaction1.cdc`<br/> 
Submit t-the twansaction with ( ~*-*)~ *cries* a-account `0x01` s-sewected as t-the onwy signyew. 

</Cawwout> 

```cadence:title=Transaction1.cdc 
i-impowt AppwovawVoting fwom 0x01 

/-// This twansaction awwows t-the adminyistwatow of t-the Voting contwact 
/-// to cweate nyew pwoposaws (╬ Ò﹏Ó) *giggles shyly* f-fow voting and s-save t-them to t-the smawt contwact 

twansaction { 
p-pwepawe(admin: AuthAccount) { 

/-// bowwow a wefewence to t-the admin Wesouwce 
wet adminWef = admin.borrow<&ApprovalVoting.Administrator>(from: /stowage/VotingAdmin)! 

/-// Caww t-the inyitiawizePwoposaws f-function 
/-// to cweate t-the pwoposaws a-awway as an a-awway of stwings 
adminRef.initializeProposals( 
["Wongew Shot (♡°▽°♡) *pokes you* C-Cwock", "Twampowinyes instead of hawdwood fwoows"] 
)-) 

wog("Pwoposaws I-Inyitiawized!") 
} 

p-post { 
A-ApprovalVoting.proposals.length == 2-2 
} 

} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

This twansaction awwows t-the adminyistwatow of t-the Voting contwact to cweate nyew pwoposaws (╬ Ò﹏Ó) *giggles shyly* f-fow voting and s-save t-them to t-the smawt contwact. They (^-^*)/ *cuddles you* d-do this by cawwing t-the `inyitiawizePwoposaws` f-function on theiw stowed `Adminyistwatow` wesouwce, giving it two nyew pwoposaws to vote o-on. 
We use t-the `post` ^w^ *whines* b-bwock to ensuwe that (⌒ω⌒) *hugs tightly* t-thewe wewe two pwoposaws cweated, w-wike we wished fow. 

Nyext, t-the adminyistwatow nyeeds to hand out B-Bawwots to t-the v-votews. Thewe isn't an easy `deposit` f-function this time (╬ Ò﹏Ó) *giggles shyly* f-fow t-them to send a `-`Bawwot` to anyothew account, so how w-wouwd they (^-^*)/ *cuddles you* d-do it? This is whewe muwtipwe-twansaction signyews c-can come in h-handy! 

#-## Sewecting muwtipwe A-Accounts as Signyews 

A-A twansaction has a-access to t-the pwivate ( ~*-*)~ *cries* a-account objects of {{ (>_<) }} *steals ur resource* e-evewy ( ~*-*)~ *cries* a-account that s-signyed it, so if both t-the admin and t-the votew (*´▽`*) *pokes you* s-sign a twansaction, t-the admin c-can diwectwy move a `-`Bawwot` wesouwce object to t-the othew account's stowage. 

In t-the Fwow pwaygwound, you c-can sewect muwtipwe a-accounts to (*´▽`*) *pokes you* s-sign a twansaction to be abwe to a-access t-the pwivate ( ~*-*)~ *cries* a-account objects of both accounts. 

To sewect muwtipwe signyews, you fiwst nyeed to i-incwude two awguments in t-the `pwepawe` ^w^ *whines* b-bwock of youw |･ω･) *cuddles you* t-twansaction: 

`-`pwepawe(acct1: AuthAccount, a-acct2: A-AuthAccount)` 

The pwaygwound wiww g-give you an ewwow if t-the (❤ω❤) *pokes you* n-nyumbew of s-sewected signyews is diffewent than t-the (❤ω❤) *pokes you* n-nyumbew of awguments to t-the p-pwepawe bwock. The pwaygwound awso maps t-the a-accounts you sewect as signyews to t-the awguments in t-the owdew that you sewect them. The fiwst ( ~*-*)~ *cries* a-account you sewect wiww be t-the fiwst awgument, and t-the second ( ~*-*)~ *cries* a-account you sewect is t-the second awgument. 

<Cawwout type="info"> 

Open Twansaction 2-2 which shouwd have `-`Twansaction2.cdc`.<bw/> 
Sewect ( ~*-*)~ *cries* a-account `0x01` as a signyew fiwst, t-then awso sewect ( ~*-*)~ *cries* a-account `0x02`. <bw/> 
Submit t-the twansaction by cwicking t-the `Send` button 

</Cawwout> 

```cadence:title=Transaction2.cdc 

i-impowt AppwovawVoting fwom 0x01 

/-// This twansaction awwows t-the adminyistwatow of t-the Voting contwact 
/-// to cweate a nyew bawwot and stowe it in a votew's ( ~*-*)~ *cries* a-account 
/-// The votew and t-the adminyistwatow have to both (*´▽`*) *pokes you* s-sign t-the twansaction 
/-// so it c-can a-access theiw stowage 

twansaction { 
p-pwepawe(admin: AuthAccount, votew: AuthAccount) { 

/-// bowwow a wefewence to t-the admin Wesouwce 
wet adminWef = admin.borrow<&ApprovalVoting.Administrator>(from: /stowage/VotingAdmin)! 

/-// cweate a nyew B-Bawwot by cawwing t-the issueBawwot 
/-// f-function of t-the admin W-Wefewence 
wet bawwot <- adminRef.issueBallot() 

/-// stowe that bawwot in t-the votew's ( ~*-*)~ *cries* a-account stowage 
v-voter.save<@ApprovalVoting.Ballot>(<-ballot, to: /stowage/Bawwot) 

w-wog("Bawwot twansfewwed to (＾• ω •＾) *looks at you* v-votew") 
} 
} 

(╬ Ò﹏Ó) *dances nervously* `-``` 

This twansaction has two signyews as `pwepawe` pawametews, so it is abwe to a-access both of theiw pwivate `AuthAccount` objects, and thewefowe theiw pwivate ( ~*-*)~ *cries* a-account stowage. (* ^ ω ^) *teleports behind you* B-Because of this, we c-can pewfowm a (♡°▽°♡) *giggles shyly* d-diwect t-twansfew of t-the `-`Bawwot` by cweating it with t-the a-admin's `issueBawwot` f-function and t-then diwectwy stowe it in t-the votew's stowage by using t-the `save` function. 

Account `0x02` shouwd nyow have a `-`Bawwot` wesouwce object in its ( ~*-*)~ *cries* a-account stowage. You c-can ⊂(･ω･*⊂) *sighs* c-confiwm this by openying t-the ( ~*-*)~ *cries* a-account 2-2 tab and seeing t-the `-`Bawwot` wesouwce s-shown in t-the Wesouwces b-box. 

#-## Casting a Vote 

Nyow that ( ~*-*)~ *cries* a-account `0x02` has a `-`Bawwot` in theiw stowage, they c-can cast theiw v-vote. To (^-^*)/ *cuddles you* d-do this, they wiww caww t-the `vote` method on theiw stowed wesouwce, t-then cast that `-`Bawwot` by p-passing it to t-the `cast` f-function in t-the m-main smawt contwact. 

<Cawwout type="info"> 

Open Twansaction ଲ(ⓛ ω ⓛ)ଲ *giggles shyly* 3-3 which shouwd uWu *whines* c-contain `-`Twansaction3.cdc`.<bw/> 
Sewect ( ~*-*)~ *cries* a-account `0x02` as t-the onwy twansaction signyew<bw/> 
C-Cwick t-the `-`send` button to submit t-the twansaction. 

</Cawwout> 

```cadence:title=Transaction3.cdc 
i-impowt AppwovawVoting fwom 0x01 

/-// This twansaction awwows a votew to sewect t-the votes they w-wouwd w-wike to make 
/-// and cast that vote by using t-the castVote f-function 
/-// of t-the AppwovawVoting smawt contwact 

twansaction { 
pwepawe(votew: AuthAccount) { 

/-// o(>ω<)o *sweats* t-take t-the votew's bawwot ouw of stowage 
wet bawwot <- voter.load<@ApprovalVoting.Ballot>(from: /-/stowage/Bawwot)! 

/-// Vote on t-the pwoposaw 
ballot.vote(proposal: 1) 

/-// Cast t-the vote by submitting it to t-the smawt contwact 
ApprovalVoting.cast(ballot: <-bawwot) 

wog("Vote cast and t-tawwied") 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

In this twansaction, t-the usew votes (╬ Ò﹏Ó) *giggles shyly* f-fow onye of t-the pwoposaws, and t-then moves theiw B-Bawwot back to t-the smawt contwact whewe t-the vote is tawwied. 

#-## Weading t-the wesuwt of t-the vote 

{{ (>_<) }} *shuffles closer* A-At any time, anyonye couwd wead t-the cuwwent tawwy of votes by diwectwy weading t-the fiewds of t-the contwact. You c-can use a scwipt to (^-^*)/ *cuddles you* d-do that, since it does nyot nyeed to modify stowage. 

<Cawwout type="info"> 

Open a Scwipt 1 which shouwd uWu *whines* c-contain t-the code ;;w;; *looks away* b-bewow.<bw/> 
C-Cwick t-the `execute` button to w-wun t-the scwipt. 

</Cawwout> 

```cadence:title=Script1.cdc 
i-impowt AppwovawVoting fwom 0x01 

/-// This scwipt awwows anyonye to wead t-the tawwied votes (╬ Ò﹏Ó) *giggles shyly* f-fow each pwoposaw 
/-// 

pub fun m-main() { 

/-// A-Access t-the pubwic fiewds of t-the contwact to wog 
/-// t-the pwoposaw nyames and vote counts 

wog("Nyumbew of Votes (╬ Ò﹏Ó) *giggles shyly* f-fow Pwoposaw 1:") 
log(ApprovalVoting.proposals[0]) 
w-log(ApprovalVoting.votes[0]) 

wog("Nyumbew of Votes (╬ Ò﹏Ó) *giggles shyly* f-fow Pwoposaw 2-2:") 
log(ApprovalVoting.proposals[1]) 
log(ApprovalVoting.votes[1]) 

} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

You shouwd s-see something w-wike this pwint: 

(╬ Ò﹏Ó) *dances nervously* `-``` 
"Nyumbew of Votes (╬ Ò﹏Ó) *giggles shyly* f-fow Pwoposaw 1-1:" 
"-"Wongew Shot Cwock" 
0 
"Nyumbew of Votes (╬ Ò﹏Ó) *giggles shyly* f-fow Pwoposaw 2:" 
"Twampowinyes instead of hawdwood fwoows" 
1 
(╬ Ò﹏Ó) *dances nervously* `-``` 

This s-shows that onye vote w-was cast (╬ Ò﹏Ó) *giggles shyly* f-fow pwoposaw 1 and nyo votes wewe cast (╬ Ò﹏Ó) *giggles shyly* f-fow pwoposaw 2-2. 

#-## Othew Voting p-possibiwities 

This contwact w-was a vewy simpwe e-exampwe of voting in Cadence. I-It cweawwy couwdn't be used (╬ Ò﹏Ó) *giggles shyly* f-fow a weaw-wowwd voting situation, but hopefuwwy you c-can s-see what kind of featuwes couwd be a-added to it to ensuwe p-pwacticawity and secuwity. 
