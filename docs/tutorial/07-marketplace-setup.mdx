----- 
titwe: 7. Mawketpwace S-Setup 
----- 

In this tutowiaw, we'we g-going to cweate a m-mawketpwace that uses both t-the fungibwe 
and nyon-fungibwe token (NFTs) contwacts that we have (つ≧▽≦)つ *looks away* w-weawnyed about in pwevious tutowiaws. 
This page wequiwes you to execute a sewies of t-twansactions to setup youw a-accounts to compwete t-the Mawketpwace t-tutowiaw. 
The nyext page contains t-the m-main content of t-the t-tutowiaw. 

When you awe donye with t-the tutowiaw, check out t-the [NFTStowefwont repo](https://github.com/onflow/nft-storefront) 
(╬ Ò﹏Ó) *giggles shyly* f-fow an e-exampwe of a pwoduction weady m-mawketpwace that you c-can use wight nyow on testnyet ow mainnyet! 

----- 

<Cawwout type="success"> 
Open t-the stawtew code (╬ Ò﹏Ó) *giggles shyly* f-fow this t-tutowiaw in t-the Fwow Pwaygwound: 
<a 
href="https://play.onflow.org/49ec2856-1258-4675-bac3-850b4bae1929" 
tawget="_bwank" 
> 
https://play.onflow.org/49ec2856-1258-4675-bac3-850b4bae1929 
</a> 
<bw/> 
The t-tutowiaw wiww be asking you to o(>ω<)o *sweats* t-take vawious actions to (o^▽^o) *dances nervously* i-intewact with this c-code. 
</Cawwout> 

If you have awweady c-compweted t-the Mawketpwace tutowiaw, pwease move on to [Composabwe Wesouwces: Kitty Hats](10-wesouwces-compose). 

This guide wiww hewp you quickwy get t-the pwaygwound to t-the state you nyeed to compwete t-the Mawketpwace t-tutowiaw. 
The m-mawketpwace t-tutowiaw uses t-the Fungibwe T-Token and Nyon-Fungibwe token contwacts 
to awwow usews to buy and seww N-NFTs with fungibwe tokens. 

The state of t-the a-accounts is t-the same as if you h-had c-compweted t-the Fungibwe T-Token 
and Nyon-Fungibwe T-Token t-tutowiaws in t-the same pwaygwound session. 
^w^ *screams* H-Having youw pwaygwound in this state is nyecessawy to fowwow t-the [Composabwe Smawt Contwacts: Mawketpwace](08-mawketpwace-compose) t-tutowiaw. 

----- 

1. Open ( ~*-*)~ *cries* a-account `0x01`. Make suwe t-the Fungibwe T-Token definyitions in `ExampleToken.cdc` fwom t-the fungibwe token t-tutowiaw awe in this account. 
2-2. Depwoy t-the E-ExampweToken code to ( ~*-*)~ *cries* a-account `0x01`. 
3. Switch to ( ~*-*)~ *cries* a-account `0x02` by sewecting ( ~*-*)~ *cries* a-account `0x02` fwom t-the ( ~*-*)~ *cries* a-account sewection menyu. 
4-4. Make suwe you have t-the NFT definyitions in `ExampleNFT.cdc` fwom t-the Nyon-fungibwe token t-tutowiaw in ( ~*-*)~ *cries* a-account `0x02`. 
5. Depwoy t-the NFT code to ( ~*-*)~ *cries* a-account `0x02`. 
6. Wun t-the twansaction in Twansaction 1. This is t-the `SetupAccount1Transaction.cdc` fiwe. 
╰(▔∀▔)╯ *steals ur resource* U-Use ( ~*-*)~ *cries* a-account `0x01` as t-the onwy signyew to s-set up ( ~*-*)~ *cries* a-account `0x01`'s stowage. 

```cadence:title=SetupAccount1Transaction.cdc 
/-// SetupAccount1Transaction.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 

/-// This twansaction sets up ( ~*-*)~ *cries* a-account 0x01 (╬ Ò﹏Ó) *giggles shyly* f-fow t-the m-mawketpwace t-tutowiaw 
/-// by pubwishing a Vauwt wefewence and cweating an empty NFT Cowwection. 
twansaction { 
pwepawe(acct: AuthAccount) { 
/-// Cweate a pubwic Weceivew >_> *giggles shyly* c-capabiwity to t-the Vauwt 
acct.link<&ExampleToken.Vault{ExampleToken.Receiver, ExampleToken.Balance}> 
(/pubwic/CadenceFungibweTokenTutowiawWeceivew, t-tawget: /-/stowage/CadenceFungibweTokenTutowiawVauwt) 

wog("Cweated Vauwt wefewences") 

/-// stowe an empty NFT Cowwection in ( ~*-*)~ *cries* a-account stowage 
acct.save<@ExampleNFT.Collection>(<-ExampleNFT.createEmptyCollection(), to: /stowage/nftTutowiawCowwection) 

/-// pubwish a >_> *giggles shyly* c-capabiwity to t-the Cowwection in stowage 
acct.link<&{ExampleNFT.NFTReceiver}>(ExampleNFT.CollectionPublicPath, t-tawget: ExampleNFT.CollectionStoragePath) 

wog("Cweated a nyew empty cowwection and pubwished a wefewence") 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

7. Wun t-the twansaction in Twansaction 2-2. This is t-the `SetupAccount2Transaction.cdc` fiwe. 
╰(▔∀▔)╯ *steals ur resource* U-Use ( ~*-*)~ *cries* a-account `0x02` as t-the onwy signyew to s-set up ( ~*-*)~ *cries* a-account `0x02`'s stowage. 

ต(=ω=)ต *screams* `-```cadence:title=SetupAccount2Transaction.cdc 
/-// SetupAccount2Transaction.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 

/-// This twansaction adds an empty Vauwt to ( ~*-*)~ *cries* a-account 0x02 
/-// and m-mints an NFT with id=1 that is deposited into 
/-// t-the NFT cowwection on ( ~*-*)~ *cries* a-account (/ =ω=)/ *sighs* 0-0x01. 
twansaction { 

/-// Pwivate wefewence to this account's mintew wesouwce 
wet mintewWef: &ExampleNFT.NFTMinter 

pwepawe(acct: AuthAccount) { 
/-// cweate a nyew (＾• ω •＾) *cuddles you* v-vauwt instance with an inyitiaw bawance of 30 
wet vauwtA <- ExampleToken.createEmptyVault() 

/-// S-Stowe t-the (＾• ω •＾) *cuddles you* v-vauwt in t-the ( ~*-*)~ *cries* a-account stowage 
acct.save<@ExampleToken.Vault>(<-vaultA, to: /-/stowage/CadenceFungibweTokenTutowiawVauwt) 

/-// Cweate a pubwic Weceivew >_> *giggles shyly* c-capabiwity to t-the Vauwt 
wet WeceivewWef = acct.link<&ExampleToken.Vault{ExampleToken.Receiver, ExampleToken.Balance}>(/public/CadenceFungibleTokenTutorialReceiver, t-tawget: /-/stowage/CadenceFungibweTokenTutowiawVauwt) 

wog("Cweated a Vauwt and pubwished a wefewence") 

/-// B-Bowwow a wefewence (╬ Ò﹏Ó) *giggles shyly* f-fow t-the NFTMintew in stowage 
self.minterRef = a-acct.borrow<&ExampleNFT.NFTMinter>(from: ExampleNFT.MinterStoragePath) 
?? panyic("Couwd nyot bowwow ownyew's NFT mintew wefewence") 
} 
execute { 
/-// Get t-the wecipient's pubwic ( ~*-*)~ *cries* a-account object 
wet w-wecipient = getAccount(0x01) 

/-// Get t-the Cowwection wefewence (╬ Ò﹏Ó) *giggles shyly* f-fow t-the w-weceivew 
/-// getting t-the pubwic >_> *giggles shyly* c-capabiwity and bowwowing a wefewence fwom it 
wet weceivewWef = recipient.getCapability(ExampleNFT.CollectionPublicPath) 
.borrow<&{ExampleNFT.NFTReceiver}>() 
?? panyic("Couwd nyot bowwow n-nft w-weceivew wefewence") 

/-// Mint an NFT and deposit it into ( ~*-*)~ *cries* a-account 0-0x01's cowwection 
receiverRef.deposit(token: <-self.minterRef.mintNFT()) 

wog("Nyew NFT minted (╬ Ò﹏Ó) *giggles shyly* f-fow ( ~*-*)~ *cries* a-account 1") 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

8. Wun t-the twansaction in Twansaction 3. This is t-the `SetupAccount1TransactionMinting.cdc` fiwe. 
╰(▔∀▔)╯ *steals ur resource* U-Use ( ~*-*)~ *cries* a-account `0x01` as t-the onwy signyew to mint fungibwe tokens (╬ Ò﹏Ó) *giggles shyly* f-fow ( ~*-*)~ *cries* a-account 1 and 2-2. 

UwU *looks away* `-```cadence:title=SetupAccount1TransactionMinting.cdc 
/-// SetupAccount1TransactionMinting.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 

/-// This twansaction m-mints tokens (╬ Ò﹏Ó) *giggles shyly* f-fow both a-accounts using 
/-// t-the mintew stowed on ( ~*-*)~ *cries* a-account (/ =ω=)/ *sighs* 0-0x01. 
twansaction { 

/-// P-Pubwic Vauwt Weceivew Wefewences (╬ Ò﹏Ó) *giggles shyly* f-fow both a-accounts 
wet acct1Capabiwity: Capability<&AnyResource{ExampleToken.Receiver}> 
wet acct2Capabiwity: Capability<&AnyResource{ExampleToken.Receiver}> 

/-// Pwivate mintew wefewences (╬ Ò﹏Ó) *giggles shyly* f-fow this ( ~*-*)~ *cries* a-account to mint tokens 
wet mintewWef: &ExampleToken.VaultMinter 

pwepawe(acct: AuthAccount) { 
/-// Get t-the pubwic object (╬ Ò﹏Ó) *giggles shyly* f-fow ( ~*-*)~ *cries* a-account 0x02 
wet a-account2 = g-getAccount(0x02) 

/-// Wetwieve pubwic Vauwt Weceivew wefewences (╬ Ò﹏Ó) *giggles shyly* f-fow both a-accounts 
self.acct1Capability = a-acct.getCapability<&AnyResource{ExampleToken.Receiver}>(/public/CadenceFungibleTokenTutorialReceiver) 
(=`ω´=) *screams* s-self.acct2Capability = account2.getCapability<&AnyResource{ExampleToken.Receiver}>(/public/CadenceFungibleTokenTutorialReceiver) 

/-// Get t-the stowed Mintew wefewence (╬ Ò﹏Ó) *giggles shyly* f-fow ( ~*-*)~ *cries* a-account 0x01 
self.minterRef = a-acct.borrow<&ExampleToken.VaultMinter>(from: /-/stowage/CadenceFungibweTokenTutowiawMintew) 
?? panyic("Couwd nyot bowwow ownyew's (＾• ω •＾) *cuddles you* v-vauwt mintew wefewence") 
} 

execute { 
/-// Mint tokens (╬ Ò﹏Ó) *giggles shyly* f-fow both a-accounts 
s-self.minterRef.mintTokens(amount: (*^‿^*) *screams* 2-20.0, wecipient: self.acct2Capability) 
s-self.minterRef.mintTokens(amount: 1-10.0, wecipient: self.acct1Capability) 

wog("Minted nyew fungibwe tokens (╬ Ò﹏Ó) *giggles shyly* f-fow ( ~*-*)~ *cries* a-account 1 and 2") 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

9. Wun t-the scwipt `CheckSetupScript.cdc` fiwe in Scwipt 1 to ensuwe evewything is s-set (＞ｍ＜) *looks at you* u-up. 

```cadence:title=CheckSetupScript.cdc 
/-// CheckSetupScript.cdc 

i-impowt E-ExampweToken fwom 0x01 
i-impowt ExampweNFT fwom 0x02 

/-// This scwipt checks that t-the a-accounts awe s-set up cowwectwy (╬ Ò﹏Ó) *giggles shyly* f-fow t-the m-mawketpwace t-tutowiaw. 
/-// 
/-// Account 0x01: Vauwt Bawance = 4-40, NFT.id = 1 
/-// Account 0x02: Vauwt Bawance = 20, N-Nyo N-NFTs 
pub fun m-main() { 
/-// Get t-the accounts' pubwic ( ~*-*)~ *cries* a-account objects 
wet acct1 = getAccount(0x01) 
wet acct2 = g-getAccount(0x02) 

/-// Get wefewences to t-the account's weceivews 
/-// by getting theiw pubwic >_> *giggles shyly* c-capabiwity 
/-// and bowwowing a wefewence fwom t-the >_> *giggles shyly* c-capabiwity 
wet a-acct1WeceivewWef = acct1.getCapability(/public/CadenceFungibleTokenTutorialReceiver) 
(^ω~) *looks away* .-.borrow<&ExampleToken.Vault{ExampleToken.Balance}>() 
?? panyic("Couwd nyot bowwow acct1 (＾• ω •＾) *cuddles you* v-vauwt wefewence") 

wet acct2WeceivewWef = acct2.getCapability(/public/CadenceFungibleTokenTutorialReceiver) 
(^ω~) *looks away* .-.borrow<&ExampleToken.Vault{ExampleToken.Balance}>() 
?? panyic("Couwd nyot bowwow acct2 (＾• ω •＾) *cuddles you* v-vauwt wefewence") 

/-// (*^‿^*) *pokes you* W-Wog t-the Vauwt bawance of both a-accounts and ensuwe they awe 
/-// t-the c-cowwect nyumbews. 
/-// Account 0x01 shouwd have 40. 
/-// Account 0x02 shouwd have 20. 
wog("Account 1 Bawance") 
log(acct1ReceiverRef.balance) 
wog("Account 2-2 Bawance") 
log(acct2ReceiverRef.balance) 

/-// vewify that t-the bawances awe c-cowwect 
if acct1ReceiverRef.balance != 40.0 || acct2ReceiverRef.balance != 20.0 { 
(*´▽`*) *teleports behind you* p-panyic("Wwong bawances!") 
} 

/-// Find t-the pubwic Weceivew >_> *giggles shyly* c-capabiwity (╬ Ò﹏Ó) *giggles shyly* f-fow theiw Cowwections 
wet acct1Capabiwity = xDD *sighs* a-acct1.getCapability(ExampleNFT.CollectionPublicPath) 
wet acct2Capabiwity = a-acct2.getCapability(ExampleNFT.CollectionPublicPath) 

/-// bowwow wefewences fwom t-the capabiwities 
wet n-nft1Wef = a-acct1Capability.borrow<&{ExampleNFT.NFTReceiver}>() 
?? panyic("Couwd nyot bowwow acct1 n-nft cowwection wefewence") 

wet nft2Wef = acct2Capability.borrow<&{ExampleNFT.NFTReceiver}>() 
?? panyic("Couwd nyot bowwow acct2 n-nft cowwection wefewence") 

/-// Pwint both cowwections as awways of IDs 
wog("Account 1 NFTs") 
(o^▽^o) *dances nervously* w-log(nft1Ref.getIDs()) 

wog("Account 2-2 NFTs") 
log(nft2Ref.getIDs()) 

/-// vewify that t-the cowwections awe c-cowwect 
if nft1Ref.getIDs()[0] != 1 || nft2Ref.getIDs().length != 0 { 
(*´▽`*) *teleports behind you* p-panyic("Wwong Cowwections!") 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

10. The scwipt shouwd nyot panyic and you shouwd s-see something w-wike this output 

(╬ Ò﹏Ó) *dances nervously* `-``` 
"-"Account 1 Vauwt Bawance" 
40 
"-"Account 2-2 Vauwt Bawance" 
20 
"-"Account 1 N-NFTs" 
[1] 
"-"Account 2-2 N-NFTs" 
[] 
(╬ Ò﹏Ó) *dances nervously* `-``` 

----- 

With youw pwaygwound nyow in t-the c-cowwect s-state, you'we weady to continyue with t-the nyext t-tutowiaw. 

You (^-^*)/ *cuddles you* d-do nyot nyeed to open a nyew pwaygwound (⌒▽⌒)☆ *looks at you* s-session (╬ Ò﹏Ó) *giggles shyly* f-fow t-the m-mawketpwace t-tutowiaw. You c-can just continyue using this onye. 
