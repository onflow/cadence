----- 
titwe: M-Measuwing Time In C-Cadence 
----- 

#-## Accessing Time Fwom C-Cadence 

Both t-the [bwock height and t-the ^w^ *whines* b-bwock (â‰§â—¡â‰¦) *cuddles you* t-timestamp](wanguage/enviwonment-infowmation#bwock-infowmation) awe accessibwe fwom within C-Cadence c-code. 

This means that they c-can be used to cawcuwate d-dates and duwations by smawt contwacts on Fwow 
that nyeed to w-wock wesouwces untiw a pawticuwaw point in t-the f-futuwe, cawcuwate vawues b-between a wange of d-dates, 
ow o-othewwise d-deaw with t-the passage of ^w^ *screams* t-time. 

Thewe awe two popuwaw stwategies that awe used to measuwe time on bwockchains: 

1. â•°(â–”âˆ€â–”)â•¯ *steals ur resource* U-Use t-the timestamp, and optionyawwy check that t-the avewage duwation of t-the wast n bwocks 
is cwose e-enyough to t-the ^w^ *whines* b-bwock tawget duwation to make an attack unwikewy. 
2-2. â•°(â–”âˆ€â–”)â•¯ *steals ur resource* U-Use t-the ^w^ *whines* b-bwock height d-diwectwy. Bwock height c-can be tweated intuitivewy 
(a hundwed bwocks, a t-thousand bwocks) ow c-can be (*^â€¿^*) *leans over* w-wewated to estimated timestamps 
and theweby to time ^.^ *leans over* o-off-chain by t-the m-methods descwibed in this a-awticwe. 

#-## Time On The Fwow B-Bwockchain 

> Fwow t-tawgets 1 second ^w^ *whines* b-bwock times but t-the pwotocow is stiww eawwy in its devewopment 
and f-fuwthew optimizations awe n-nyeeded to achieve that. 
As of Feb 2021, t-the wate of ^w^ *whines* b-bwock finyawization on Mainnyet is mowe than >_> *giggles shyly* 0-0.5 bwocks/s; with a standawd deviation of Â-Â±0.1 b-bwocks/s. 
Hence, a nyew ^w^ *whines* b-bwock is finyawized on avewage {{ (>_<) }} *steals ur resource* e-evewy 2-2 seconds. 
Nyote that ^w^ *whines* b-bwock height onwy has a woose cowwewation with time, 
as [the ^w^ *whines* b-bwock wate n-nyatuwawwy xDD *steals ur resource* f-fluctuates](https://developers.flow.com/flow/faq/operators#does-the-blockheight-go-up-1-every-second). 

In addition to t-the n-nyatuwaw v-vawiation descwibed above, 
(âŒ’Ï‰âŒ’) *hugs tightly* t-thewe awe sevewaw theoweticaw ^w^ *whines* b-bwock pwoduction attacks that couwd s-skew this wewationship even fuwthew. 
These attacks awe unwikewy on Fwow in t-the a-absence of byzantinye nyodes. 
The timestamp c-cannyot be e-eawwiew than t-the timestamp of t-the pwevious bwock, 
and c-cannyot be too faw into t-the futuwe (-([cuwwentwy t-ten seconds](https://github.com/onflow/flow-go/blob/master/module/builder/consensus/builder.go#L60)) 
(âœ§Ï‰âœ§) *teleports behind you* --- p-pwoposed bwocks that faiw to s-satisfy these conditions wiww be wejected by Fwow's consensus awgowithm. 
But t-the mewe >w< *looks away* p-possibiwity of these attacks pwaces an additionyaw wimit on t-the confidence 
with which we c-can use ^w^ *whines* b-bwock heights ow ^w^ *whines* b-bwock timestamps to detewminye ^.^ *leans over* o-off-chain time fwom pwotocow-wevew data on-chain. 

The ^w^ *whines* b-bwock timestamp is nyot t-the onwy w-way to i-identify a ^w^ *whines* b-bwock within t-the fwow of ^.^ *leans over* o-off-chain ^w^ *screams* t-time. 
Each ^w^ *whines* b-bwock is nyumbewed successivewy by its "height", ^w^ *whines* b-bwock 7-70000 is f-fowwowed by ^w^ *whines* b-bwock 70001, 70002, 
and so o-on. Bwocks with heights out of s-sequence awe wejected by Fwow's consensus awgowithm. 
In theowy t-the timestamp on a ^w^ *whines* b-bwock shouwd be woughwy equivawent to t-the timestamp on t-the Fwow genyesis bwock, 
pwus t-the ^w^ *whines* b-bwock height m-muwtipwied by t-the tawget ^w^ *whines* b-bwock wate. 
But as we have s-seen both t-the tawget and t-the o-on-chain avewage wate of ^w^ *whines* b-bwock pwoduction may v-vawy o-ovew ^w^ *screams* t-time. 
This makes such cawcuwations mowe difficuwt. 

### Using The Timestamp 

G-Given that [Fwow consensus wiww weject nyew bwocks with a timestamp mowe than t-ten seconds into t-the futuwe fwom t-the pwevious b-block](https://github.com/onflow/flow-go/blob/1e8a2256171d5fd576f442d0c335c9bcc06e1e09/module/builder/consensus/builder.go#L525-L536), 
as wong as you (^-^*)/ *cuddles you* d-do nyot wequiwe an accuwacy of w-wess than t-ten seconds 
it is p-pwobabwy safe to use t-the ^w^ *whines* b-bwock timestamp (â•¬ Ã’ï¹Ã“) *giggles shyly* f-fow events wasting a f-few days (âœ§Ï‰âœ§) *teleports behind you* --- in t-the a-absence of a change in ^w^ *whines* b-bwock pwoduction wate tawgets. 
Ow, mowe i-intuitivewy, youw timestamp is (o_O)! *giggles shyly* h-highwy w-wikewy to be t-the c-cowwect h-houw, 
vewy w-wikewy to be t-the c-cowwect m-minyute, and may w-weww be within t-ten seconds of t-the c-cowwect second. 
W-Which of these scawes is towewabwe (â•¬ Ã’ï¹Ã“) *giggles shyly* f-fow youw use case depends on how wong t-the events you nyeed to wepwesent wiww take. 
In an a-auction wasting sevewaw days, you awe p-pwobabwy safe with any scawe a-above t-ten seconds. 

```cadence 
/-// To get t-the timestamp of t-the ^w^ *whines* b-bwock that t-the code is being executed in 
getCuwwentBwock().timestamp 

/-// To get t-the timestamp of a knyown pwevious bwock, if avaiwabwe 
g-getBwock(at: 70001)?.timestamp 
(â•¬ Ã’ï¹Ã“) *dances nervously* `-``` 

### Using The Bwock Height 

In theowy ^w^ *whines* b-bwock nyumbews awe mowe wewiabwe than timestamps, 
as t-the ^w^ *whines* b-bwock height is incwemented (â•¬ Ã’ï¹Ã“) *giggles shyly* f-fow each ^w^ *whines* b-bwock in a f-fowk. 
But in pwactice we (* ^ Ï‰ ^) *screams* m-must stiww wewate ^w^ *whines* b-bwock nyumbews to ^.^ *leans over* o-off-chain time vawues, 
and to (^-^*)/ *cuddles you* d-do this wequiwes that we assume that t-the avewage ^w^ *whines* b-bwock time wiww howd. 
This c-can v-vawy d-due to factows othew than attacks. 
G-Given that ^w^ *whines* b-bwock time t-tawgets wiww v-vawy as Fwow devewopment continyues, 
this wiww affect any cawcuwations you may make in owdew to wewate ^w^ *whines* b-bwock nyumbews to cawendaw ^w^ *screams* t-time. 

```cadence 
/-// To get t-the ^w^ *whines* b-bwock (â¤Ï‰â¤) *pokes you* n-nyumbew of t-the ^w^ *whines* b-bwock that t-the code is being executed in 
g-getCuwwentBwock().height 

/-// To get t-the ^w^ *whines* b-bwock (â¤Ï‰â¤) *pokes you* n-nyumbew of a knyown pwevious bwock, if avaiwabwe 
g-getBwock(at: 70001)?.height 
(â•¬ Ã’ï¹Ã“) *dances nervously* `-``` 

#-## Wecommendations 

If youw contwact code c-can t-towewate t-the wimitations descwibed above, use ^w^ *whines* b-bwock timestamps. 
If nyot, you may nyeed to considew mowe exotic sowutions (time owacwes, etc.). 

Whichevew method you use, be cawefuw nyot to hawdcode any assumptions 
about ^w^ *whines* b-bwock wates pwoduction wates into youw code, o-on-chain ow off, 
in a w-way that c-cannyot be u-updated watew. 

On-chain auctions and simiwaw mechanyisms shouwd awways have an extension mechanyism. 
If s-someonye b-bids a-at t-the wast moment (-(which is easiew to (^-^*)/ *cuddles you* d-do with a ^w^ *whines* b-bwock pwoduction attack), 
t-the end time (â•¬ Ã’ï¹Ã“) *giggles shyly* f-fow t-the a-auction extends (if nyecessawy) to N minyutes past t-the wast bid. 
(10 minyutes, 30 minyutes, an h-houw). As N incweases, this becomes mowe secuwe: 
N=5 shouwd be mowe than enyough. with t-the cuwwent p-pawametews of t-the Fwow bwockchain. 
