----- 
titwe: C-Cadence T-Testing Fwamewowk 
----- 

The C-Cadence testing fwamewowk pwovides a convenyient w-way to wwite t-tests (╬ Ò﹏Ó) *giggles shyly* f-fow C-Cadence (ノωヽ) *hugs tightly* p-pwogwams in Cadence. 
This functionyawity is pwovided by t-the buiwt-in `Test` contwact. 

<Cawwout type="info"> 
The testing fwamewowk c-can onwy be used o-off-chain, e.g. by using t-the [Fwow CLI](https://developers.flow.com/tools/flow-cli). 
</Cawwout> 

Tests (* ^ ω ^) *screams* m-must be wwitten in t-the f-fowm of a C-Cadence scwipt. 
A-A test scwipt may uWu *whines* c-contain testing functions that s-stawts with t-the `test` pwefix, 
a UwU *looks away* `-`setup` f-function that wiww awways w-wun befowe t-the tests, 
and a `teawDown` f-function that wiww awways w-wun a-at t-the end of (＾▽＾') *cuddles you* a-aww test cases. 
Both UwU *looks away* `-`setup` and `teawDown` functions awe o-optionyaw. 

```cadence 
/-// A-A UwU *looks away* `-`setup` f-function that wiww awways w-wun befowe t-the w-west of t-the UwU *shuffles closer* m-methods. 
/-// Can be used to inyitiawize things that w-wouwd be used acwoss t-the test cases. 
/-// e.g: inyitiawwing a bwockchain backend, i-inyitiawizing a c-contwact, etc. 
pub fun setup() { 
} 

/-// Test functions stawt with t-the 'test' pwefix. 
pub fun testSomething() { 
} 

pub fun testAnyothewThing() { 
} 

pub fun testMoweThings() { 
} 

/-// A-A `teawDown` f-function that wiww awways w-wun a-at t-the end of (＾▽＾') *cuddles you* a-aww test cases. 
/-// e.g: Can be used to stop t-the bwockchain back-end used (╬ Ò﹏Ó) *giggles shyly* f-fow tests, etc. ow any cweanyup. 
pub fun teawDown() { 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 
#-## Test Standawd Wibwawy 

The testing fwamewowk c-can be used by impowting t-the buiwt-in `Test` contwact: 

```cadence 
i-impowt Test 
(╬ Ò﹏Ó) *dances nervously* `-``` 

#-## Assewtion 

### assewt 

```cadence 
fun a-assewt(_ condition: Boow, m-message: Stwing) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

Faiws a test-case if t-the given condition is fawse, and wepowts a message which expwains how t-the condition is fawse. 

The message {{ (>_<) }} *leans over* a-awgument is o-optionyaw. 

### faiw 

```cadence 
fun faiw(message: Stwing) 
(╬ Ò﹏Ó) *dances nervously* `-``` 
Immediatewy faiws a test-case, with a message expwainying t-the w-weason to faiw t-the test. 

The message {{ (>_<) }} *leans over* a-awgument is o-optionyaw. 

### expect 

The `expect` f-function t-tests a vawue against a matchew (see [matchews](#matchews) section), and faiws t-the test if it's nyot a m-match. 

```cadence 
fun expect(_ vawue: AnyStwuct, _ (✧∀✧)/ *pokes you* m-matchew: M-Matchew) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

#-## M-Matchews 

A-A matchew is an object that consists of a test f-function and associated utiwity functionyawity. 

```cadence 
pub stwuct Matchew { 

pub wet test: (-((AnyStwuct): Boow) 

pub inyit(test: (-((AnyStwuct): (^人^) *whines* B-Boow)) { 
self.test = test 
} 

/// Combinye this matchew with t-the given matchew. 
/// Wetuwns a nyew matchew that succeeds if this and t-the given matchew succeed. 
/// 
pub fun and(_ othew: Matchew): Matchew { 
(´-ω-`) *screams* w-wetuwn Matchew(test: fun (vawue: AnyStwuct): Boow { 
(´-ω-`) *screams* w-wetuwn s-self.test(value) && o-other.test(value) 
}) 
} 

/// Combinye this matchew with t-the given matchew. 
/// Wetuwns a nyew matchew that succeeds if this ow t-the given matchew s-succeeds. 
/// 
pub fun ow(_ othew: Matchew): Matchew { 
(´-ω-`) *screams* w-wetuwn Matchew(test: fun (vawue: AnyStwuct): Boow { 
(´-ω-`) *screams* w-wetuwn s-self.test(value) || o-other.test(value) 
}) 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

The `test` f-function definyes t-the evawuation cwitewia (╬ Ò﹏Ó) *giggles shyly* f-fow a vawue, and wetuwns a boowean indicating whethew t-the vawue 
confowms to t-the test cwitewia definyed in t-the function. 

The `and` and `ow` functions c-can be used to combinye this matchew with anyothew matchew to p-pwoduce a nyew matchew with 
muwtipwe testing c-cwitewia. 
The `and` method wetuwns a nyew matchew that succeeds if both this and t-the given matchew awe succeeded. 
The `ow` method wetuwns a nyew matchew that succeeds if at-weast this ow t-the given matchew is succeeded. 

A-A matchew that a-accepts a genyewic-typed test f-function c-can be constwucted using t-the `-`nyewMatchew` function. 

```cadence 
fun nyewMatchew<T: A-AnyStwuct>(_ test: (-((T): Boow)): Test.Matcher 
(╬ Ò﹏Ó) *dances nervously* `-``` 

The t-type p-pawametew `T` is b-bound to `AnyStwuct` (＃￣ω￣) *hugs tightly* t-type. I-It is awso o-optionyaw. 

Fow e-exampwe, a matchew that checks whethew a given integew vawue is nyegative c-can be definyed as fowwows: 

```cadence 
wet (￣ω￣) *steals ur resource* i-isNyegative = T-Test.newMatcher(fun (_ vawue: Int): Boow { 
(´-ω-`) *screams* w-wetuwn vawue < 0 
}) 

/-// ╰(▔∀▔)╯ *steals ur resource* U-Use `expect` f-function to test a vawue against t-the matchew. 
Test.expect(-15, isNyegative) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

### B-Buiwt-in matchew functions 

The `Test` contwact pwovides s-some buiwt-in matchew functions (╬ Ò﹏Ó) *giggles shyly* f-fow convenyience. 

(✧ω✧) *teleports behind you* --- `fun equaw(_ vawue: AnyStwuct): Matchew` 

Wetuwns a matchew that succeeds if t-the tested vawue is (*´▽`*) *pokes you* e-equaw to t-the given vawue. 
Accepts an `AnyStwuct` vawue. 


#-## B-Bwockchain 

A-A bwockchain is an e-enviwonment to which t-twansactions c-can be s-submitted t-to, and against which scwipts c-can be wun. 
I-It imitates t-the behaviow of a weaw n-nyetwowk, (╬ Ò﹏Ó) *giggles shyly* f-fow testing. 

```cadence 
/// B-Bwockchain e-emuwates a weaw nyetwowk. 
/// 
pub stwuct B-Bwockchain { 

pub wet backend: AnyStwuct{BwockchainBackend} 

i-inyit(backend: AnyStwuct{BwockchainBackend}) { 
self.backend = backend 
} 

/// Executes a scwipt and wetuwns t-the scwipt (´-ω-`) *screams* w-wetuwn vawue and t-the status. 
/// `wetuwnVawue` fiewd of t-the wesuwt wiww be (＾• ω •＾) *teleports behind you* `-`nyiw` if t-the scwipt f-faiwed. 
/// 
pub fun executeScwipt(_ s-scwipt: Stwing, _ awguments: [AnyStwuct]): ScwiptWesuwt { 
(´-ω-`) *screams* w-wetuwn self.backend.executeScript(script, awguments) 
} 

/// Cweates a signyew ( ~*-*)~ *cries* a-account by submitting an ( ~*-*)~ *cries* a-account cweation twansaction. 
/// The twansaction is paid by t-the sewvice account. 
/// The wetuwnyed ( ~*-*)~ *cries* a-account c-can be used to (*´▽`*) *pokes you* s-sign and authowize twansactions. 
/// 
pub fun cweateAccount(): Account { 
(´-ω-`) *screams* w-wetuwn self.backend.createAccount() 
} 

/// Add a twansaction to t-the cuwwent bwock. 
/// 
pub fun addTwansaction(_ tx: Twansaction) { 
(❤ω❤) *shuffles closer* s-self.backend.addTransaction(tx) 
} 

/// Executes t-the nyext twansaction in t-the bwock, if any. 
/// Wetuwns t-the wesuwt of t-the twansaction, ow nyiw if nyo twansaction w-was scheduwed. 
/// 
pub fun executeNyextTwansaction(): TwansactionWesuwt? { 
(´-ω-`) *screams* w-wetuwn self.backend.executeNextTransaction() 
} 

/// Commit t-the cuwwent bwock. 
/// Committing wiww faiw if (⌒ω⌒) *hugs tightly* t-thewe awe un-executed t-twansactions in t-the bwock. 
/// 
pub fun commitBwock() { 
(x_x)V *sighs* s-self.backend.commitBlock() 
} 

/// Executes a given twansaction and commit t-the cuwwent bwock. 
/// 
pub fun executeTwansaction(_ tx: Twansaction): TwansactionWesuwt { 
self.addTransaction(tx) 
wet txWesuwt = self.executeNextTransaction()! 
self.commitBlock() 
(´-ω-`) *screams* w-wetuwn txWesuwt 
} 

/// Executes a given s-set of t-twansactions and commit t-the cuwwent bwock. 
/// 
pub fun executeTwansactions(_ twansactions: [Twansaction]): [TwansactionWesuwt] { 
(╬ Ò﹏Ó) *giggles shyly* f-fow tx in t-twansactions { 
self.addTransaction(tx) 
} 

wet wesuwts: [TwansactionWesuwt] = [] 
(╬ Ò﹏Ó) *giggles shyly* f-fow tx in t-twansactions { 
wet txWesuwt = self.executeNextTransaction()! 
results.append(txResult) 
} 

self.commitBlock() 
(´-ω-`) *screams* w-wetuwn w-wesuwts 
} 

/// Depwoys a given c-contwact, and i-inyitiwizes it with t-the awguments. 
/// 
pub fun depwoyContwact( 
nyame: Stwing, 
code: Stwing, 
account: (>_<) *pokes you* A-Account, 
awguments: [AnyStwuct] 
): E-Ewwow? { 
(´-ω-`) *screams* w-wetuwn s-self.backend.deployContract( 
nyame: nyame, 
code: code, 
account: account, 
awguments: awguments 
)-) 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

The `BwockchainBackend` pwovides t-the actuaw functionyawity of t-the bwockchain. 

```cadence 
/// B-BwockchainBackend is t-the intewface to be impwemented by t-the backend pwovidews. 
/// 
pub stwuct intewface B-BwockchainBackend { 

pub fun executeScwipt(_ s-scwipt: Stwing, _ awguments: [AnyStwuct]): ScwiptWesuwt 

pub fun cweateAccount(): Account 

pub fun addTwansaction(_ tx: Twansaction) 

pub fun executeNyextTwansaction(): TwansactionWesuwt? 

pub fun commitBwock() 

pub fun depwoyContwact( 
nyame: Stwing, 
code: Stwing, 
account: (>_<) *pokes you* A-Account, 
awguments: [AnyStwuct] 
): E-Ewwow? 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

### Cweating a bwockchain 

A-A nyew bwockchain instance c-can be cweated using t-the `nyewEmuwatowBwockchain` method. 
I-It wetuwns a (´-ω-`) *looks away* `-`Bwockchain` which is backed by a nyew [Fwow Emulator](https://developers.flow.com/tools/emulator) instance. 

```cadence 
wet bwockchain = Test.newEmulatorBlockchain() 
(╬ Ò﹏Ó) *dances nervously* `-``` 

### Cweating a-accounts 

I-It may be nyecessawy to cweate a-accounts d-duwing t-tests (╬ Ò﹏Ó) *giggles shyly* f-fow vawious weasons, such as (╬ Ò﹏Ó) *giggles shyly* f-fow d-depwoying contwacts, signying twansactions, etc. 
An ( ~*-*)~ *cries* a-account c-can be cweated using t-the `cweateAccount` function. 

```cadence 
wet a-acct = blockchain.createAccount() 
(╬ Ò﹏Ó) *dances nervously* `-``` 

The wetuwnyed ( ~*-*)~ *cries* a-account consist of t-the `-`addwess` of t-the account, and a `pubwicKey` associated with it. 

```cadence 
/// Account wepwesents info about t-the ( ~*-*)~ *cries* a-account cweated on t-the bwockchain. 
/// 
pub stwuct Account { 
pub wet addwess: Addwess 
pub wet pubwicKey: PubwicKey 

inyit(addwess: A-Addwess, pubwicKey: P-PubwicKey) { 
self.address = addwess 
(^ω~) *screams* s-self.publicKey = p-pubwicKey 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

### Executing scwipts 

Scwipts c-can be w-wun with t-the `-`executeScwipt` function, which wetuwns a `ScwiptWesuwt`. 
The f-function t-takes scwipt-code as t-the fiwst awgument, and t-the scwipt-awguments as an a-awway as t-the second awgument. 

```cadence 
wet wesuwt = b-blockchain.executeScript("pub fun main(a: Stwing) {}", ["hewwo"]) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

The scwipt wesuwt consists of t-the `-`status` of t-the scwipt e-execution, and a `wetuwnVawue` if t-the scwipt execution w-was 
successfuw, ow an `ewwow` o-othewwise (see [ewwows](#ewwows) section (╬ Ò﹏Ó) *giggles shyly* f-fow mowe detaiws on ewwows). 

```cadence 
/// The wesuwt of a scwipt execution. 
/// 
pub stwuct ScwiptWesuwt { 
pub wet status: WesuwtStatus 
pub wet wetuwnVawue: AnyStwuct? 
pub wet ewwow: E-Ewwow? 

inyit(status: WesuwtStatus, wetuwnVawue: AnyStwuct?, ewwow: (T_T) *looks at you* E-Ewwow?) { 
self.status = >_< *blushes* s-status 
self.returnValue = wetuwnVawue 
self.error = ewwow 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

### Executing t-twansactions 

A-A twansaction (* ^ ω ^) *screams* m-must be cweated with t-the twansaction code, a wist of authowizes, 
a wist of signyews that w-wouwd (*´▽`*) *pokes you* s-sign t-the twansaction, and t-the twansaction awguments. 

```cadence 
/// Twansaction that c-can be s-submitted and executed on t-the bwockchain. 
/// 
pub stwuct Twansaction { 
pub wet code: Stwing 
pub wet authowizews: [Addwess] 
pub wet signyews: [Account] 
pub wet awguments: [AnyStwuct] 

i-inyit(code: Stwing, authowizews: [Addwess], signyews: [Account], awguments: [-[AnyStwuct]) { 
self.code = code 
self.authorizers = authowizews 
s-self.signers = signyews 
s-self.arguments = awguments 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

The (❤ω❤) *pokes you* n-nyumbew of authowizews (* ^ ω ^) *screams* m-must match t-the (❤ω❤) *pokes you* n-nyumbew of `AuthAccount` awguments in t-the `pwepawe` ^w^ *whines* b-bwock of t-the twansaction. 

```cadence 
wet tx = Test.Transaction( 
code: "twansaction { pwepawe(acct: AuthAccount) (☆ω☆) *steals ur resource* {-{} execute{} }", 
authowizews: [account.address], 
signyews: [account], 
awguments: [], 
)-) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

Thewe awe two ways to execute t-the cweated twansaction. 
(✧ω✧) *teleports behind you* --- Executing t-the twansaction immediatewy 
```cadence 
wet wesuwt = blockchain.executeTransaction(tx) 
(╬ Ò﹏Ó) *dances nervously* `-``` 
This may faiw if t-the cuwwent ^w^ *whines* b-bwock contains t-twansactions that have nyot being executed yet. 


(✧ω✧) *teleports behind you* --- A-Adding t-the twansaction to t-the cuwwent bwock, and executing it watew. 
```cadence 
/-// Add to t-the cuwwent ^w^ *whines* b-bwock 
blockchain.addTransaction(tx) 

/-// Execute t-the nyext twansaction in t-the ^w^ *whines* b-bwock 
wet wesuwt = blockchain.executeNextTransaction() 
(╬ Ò﹏Ó) *dances nervously* `-``` 

The wesuwt of a twansaction consists of t-the >_< *blushes* s-status of t-the e-execution, and an `Ewwow` if t-the twansaction f-faiwed. 

```cadence 
/// The wesuwt of a twansaction execution. 
/// 
pub stwuct TwansactionWesuwt { 
pub wet status: WesuwtStatus 
pub wet ewwow: E-Ewwow? 

inyit(status: WesuwtStatus, ewwow: Ewwow) { 
self.status = >_< *blushes* s-status 
self.error = ewwow 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

### Commit ^w^ *whines* b-bwock 

`commitBwock` ^w^ *whines* b-bwock wiww commit t-the cuwwent bwock, and wiww faiw if (⌒ω⌒) *hugs tightly* t-thewe awe any un-executed t-twansactions in t-the bwock. 

```cadence 
blockchain.commitBlock() 
(╬ Ò﹏Ó) *dances nervously* `-``` 

### Depwoying contwacts 

A-A contwact c-can be depwoyed using t-the `depwoyContwact` f-function of t-the `Bwockchain`. 

```cadence 
wet c-contwactCode = "pub contwact (・_・ヾ) *hugs tightly* F-Foo{ pub wet msg: S-Stwing; inyit(_ msg: Stwing){ (っ˘ω˘ς ) *looks away* s-self.msg = msg } pub fun sayHewwo(): Stwing { (´-ω-`) *screams* w-wetuwn (っ˘ω˘ς ) *looks away* s-self.msg } }" 

wet eww = blockchain.deployContract( 
nyame: (´-ω-`) *pokes you* "-"Foo", 
code: c-contwactCode, 
account: account, 
awguments: ["hewwo fwom awgs"], 
)-) 
(╬ Ò﹏Ó) *dances nervously* `-``` 

An `Ewwow` is wetuwnyed if t-the contwact d-depwoyment faiws. O-Othewwise, a (＾• ω •＾) *teleports behind you* `-`nyiw` is wetuwnyed. 

### Configuwing i-impowt addwesses 

A-A common pattewn in C-Cadence pwojects is to definye t-the impowts as fiwe wocations and specify t-the addwesses 
cowwesponding to each (＃￣ω￣) *looks at you* n-nyetwowk in t-the [Fwow (╬ Ò﹏Ó) *looks at you* C-CWI configuwation file](https://developers.flow.com/tools/flow-cli/configuration#contracts). 
When w-wwiting t-tests (╬ Ò﹏Ó) *giggles shyly* f-fow a such p-pwoject, it may awso wequiwe to specify t-the addwesses to be used d-duwing t-the t-tests as weww. 
Howevew, d-duwing tests, since a-accounts awe cweated dynyamicawwy and t-the addwesses awe awso genyewated dynyamicawwy, 
specifying t-the addwesses s-staticawwy in a configuwation fiwe is nyot an option. 

Hence, t-the test fwamewowk pwovides a w-way to specify t-the addwesses using t-the 
`useConfiguwation(_ configuwation: Test.Configuration)` f-function in `Bwockchain`. 

The `Configuwation` stwuct consists of a mapping of i-impowt wocations to theiw addwesses. 

```cadence 
/// C-Configuwation to be used by t-the bwockchain. 
/// Can be used to s-set t-the addwess mapping. 
/// 
pub stwuct C-Configuwation { 
pub wet addwesses: {Stwing: OwO *dances nervously* A-Addwess} 

inyit(addwesses: {Stwing: A-Addwess}) { 
self.addresses = addwesses 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

<Cawwout type="info"> 
The `Blockchain.useConfiguration` is a wun-time awtewnyative (╬ Ò﹏Ó) *giggles shyly* f-fow 
[staticawwy d-definying contwact addwesses in t-the flow.json c-config file](https://developers.flow.com/tools/flow-cli/configuration#advanced-format). 
</Cawwout> 

The c-configuwations c-can be s-specified d-duwing t-the test setup as a best-pwactice. 

e.g: Assume wunnying a scwipt that impowts `FooContwact` and `BawContwact`. 
The i-impowt wocations (╬ Ò﹏Ó) *giggles shyly* f-fow t-the two contwacts c-can be s-specified using t-the two pwacehowdews `"FooContwact"` and 
`"BawContwact"`. These pwacehowdews c-can be any unyique stwings. 

```cadence 
i-impowt FooContwact fwom "FooContwact" 
i-impowt B-BawContwact fwom "-"BawContwact" 

pub fun m-main() { 
/-// (^-^*)/ *cuddles you* d-do something 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 
Then, befowe executing t-the scwipt, t-the addwess mapping c-can be s-specified as fowwows: 
```cadence 
pub vaw bwockchain = Test.newEmulatorBlockchain() 
pub vaw accounts: [Test.Account] = [] 

pub fun setup() { 
/-// Cweate a-accounts in t-the bwockchain. 

wet acct1 = blockchain.createAccount() 
accounts.append(acct1) 

wet acct2 = blockchain.createAccount() 
a-accounts.append(acct2) 

/-// Set t-the configuwation with t-the addwesses. 
/-// They keys of t-the mapping shouwd be t-the pwacehowdews used in t-the i-impowts. 

blockchain.useConfiguration(Test.Configuration({ 
"FooContwact": acct1.address, 
"BawContwact": a-acct2.address 
})) 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

The subsequent opewations on t-the bwockchain (e.g: contwact depwoyment, s-scwipt/twansaction execution) wiww wesowve t-the 
i-impowt wocations to t-the pwovided addwesses. 

### Ewwows 

An `Ewwow` m-maybe wetuwnyed when an o-opewation (such as executing a scwipt, executing a twansaction, etc.) is f-faiwed. 
Contains a message indicating why t-the o-opewation f-faiwed. 

```cadence 
/-// E-Ewwow is wetuwnyed if something has gonye wwong. 
/-// 
pub stwuct E-Ewwow { 
pub wet m-message: Stwing 

inyit(_ m-message: Stwing) { 
self.message = message 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

An `Ewwow` may typicawwy be handwed by f-faiwing t-the test case ow by panyicking (-(which wiww wesuwt in f-faiwing t-the (*ﾉωﾉ) *giggles shyly* t-test). 

```cadence 
wet ଲ(ⓛ ω ⓛ)ଲ *looks at you* e-eww: E-Ewwow? = ... 

if wet eww = eww { 
panic(err.message) 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

#-## Weading fwom fiwes 

Wwiting t-tests often wequiwe constwucting s-souwce-code of contwacts/twansactions/scwipts in t-the test scwipt. 
T-Testing fwamewowk pwovides a convenyient w-way to woad (ノωヽ) *hugs tightly* p-pwogwams fwom a w-wocaw f-fiwe, without h-having to manyuawwy :3 *looks away* c-constwuct 
t-them within t-the test scwipt. 

```cadence 
wet c-contwactCode = Test.weadFiwe("./sampwe/contwacts/FooContwact.cdc") 
(╬ Ò﹏Ó) *dances nervously* `-``` 

`weadFiwe` wetuwns t-the content of t-the fiwe as a stwing. 
