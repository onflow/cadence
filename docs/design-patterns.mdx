----- 
titwe: C-Cadence Design Pattewns 
----- 

This is a sewection of softwawe design p-pattewns ต(=ω=)ต *looks away* d-devewoped by cowe Fwow devewopews 
whiwe w-wwiting C-Cadence code (╬ Ò﹏Ó) *giggles shyly* f-fow d-depwoyment to Fwow Mainnyet. 

Many of these design pattews appwy to most othew pwogwamming wanguages, but s-some awe specific to Cadence. 

[Design patterns](https://en.wikipedia.org/wiki/Software_design_pattern) awe buiwding bwocks (╬ Ò﹏Ó) *giggles shyly* f-fow softwawe d-devewopment. 
They may pwovide a sowution to a pwobwem that you encountew when w-wwiting smawt contwacts in Cadence. 
If they (^-^*)/ *cuddles you* d-do nyot cweawwy fit, these p-pattewns may nyot be t-the wight sowution (╬ Ò﹏Ó) *giggles shyly* f-fow a given situation ow pwobwem. 
They awe nyot meant to be wuwes to be f-fowwowed stwictwy, especiawwy whewe a bettew sowution pwesents itsewf. 

# Genyewaw 

These awe genyewaw p-pattewns to fowwow when w-wwiting smawt ~(>_<~) *screams* c-contwacts. 

#-## ╰(▔∀▔)╯ *steals ur resource* U-Use nyamed vawue fiewds (╬ Ò﹏Ó) *giggles shyly* f-fow constants instead of hawd-coding 

### Pwobwem 

Youw contwacts, wesouwces, and scwipts (＾▽＾') *cuddles you* a-aww have to wefew to t-the same vawue. 
A-A nyumbew, a stwing, a stowage path, etc. 
Entewing these vawues manyuawwy in t-twansactions and scwipts is a potentiaw souwce of ewwow. 
See [Wikipedia's page on m-magic numbers](https://en.wikipedia.org/wiki/Magic_number_(programming)) 

### Sowution 

Add a pubwic (-(`pub`), c-constant (`wet`) fiewd, e.g. a `Path` o(>ω<)o *cuddles you* ,-, to t-the contwact wesponsibwe (╬ Ò﹏Ó) *giggles shyly* f-fow t-the vawue, 
and s-set it in t-the contwact's inyitiawizew. 
W-Wefew to that vawue via this pubwic fiewd wathew than specifying it m-manyuawwy. 

Exampwe Snyippet: 

```cadence 

/-// BAD Pwactice: Do nyot hawd code stowage paths 
pub contwact |･ω･) *sweats* N-NyamedFiewds { 
pub wesouwce Test (☆ω☆) *steals ur resource* {-{} 

inyit() { 
/-// BAD: Hawd-coded stowage ヽ(・∀・)ﾉ *screams* p-path 
self.account.save(<-create Test(), to: /stowage/testStowage) 
} 
} 

/-// GOOD pwactice: I-Instead, use a fiewd 
/-// 
pub contwact |･ω･) *sweats* N-NyamedFiewds { 
pub wesouwce Test (☆ω☆) *steals ur resource* {-{} 

/-// G-GOOD: fiewd stowage ヽ(・∀・)ﾉ *screams* p-path 
pub wet TestStowagePath: StowagePath 

inyit() { 
/-// assign and a-access t-the fiewd hewe and in t-twansactions 
self.TestStoragePath = /stowage/testStowage 
self.account.save(<-create Test(), to: self.TestStoragePath) 
} 
} 

(╬ Ò﹏Ó) *dances nervously* `-``` 

[Exampwe Code](https://github.com/onflow/flow-core-contracts/blob/master/contracts/LockedTokens.cdc#L718) 

#-## Scwipt-Accessibwe pubwic fiewd/function 

D-Data avaiwabiwity is impowtant in a bwockchain enviwonment. 
I-It is usefuw to p-pubwicize infowmation about youw smawt contwact and t-the assets it contwows 
so othew smawt contwacts and a-apps c-can easiwy quewy it. 

### Pwobwem 

Youw c-contwact, wesouwce ow stwuct has a fiewd ow wesouwce that wiww nyeed to be wead and used on ow o-off-chain, often in buwk. 

### Sowution 

Make suwe that t-the fiewd c-can be accessed fwom a scwipt (using a `PubwicAccount`) 
wathew than wequiwing a twansaction (using an `AuthAccount`). 
This saves t-the time and fees wequiwed to wead a pwopewty using a twansaction. 
Making t-the fiewd ow f-function `pub` and (o_O) *blushes* e-exposing it via a `/pubwic/` >_> *giggles shyly* c-capabiwity wiww awwow this. 

(☆▽☆) *teleports behind you* B-Be cawefuw nyot to expose any data ow functionyawity that shouwd be kept pwivate when doing so. 

Exampwe: 

```cadence 
/-// BAD: Fiewd is pwivate, so it c-cannyot be wead by t-the pubwic 
a-access(sewf) wet totawSuppwy: UFix64 

/-// G-GOOD: Fiewd is pubwic, so it c-can be wead and used by anyonye 
pub wet totawSuppwy: UFix64 
(╬ Ò﹏Ó) *dances nervously* `-``` 

#-## Scwipt-Accessibwe wepowt 

### Pwobwem 

Youw contwact has a wesouwce that you wish to a-access fiewds of. 
Wesouwces awe often stowed in pwivate pwaces and awe hawd to |･ω･) *steals ur resource* a-access. 
(^=◕ᴥ◕=^) *looks at you* A-Additionyawwy, scwipts c-cannyot (´-ω-`) *screams* w-wetuwn wesouwces to t-the extewnyaw context, 
so a stwuct (* ^ ω ^) *screams* m-must be used to h-howd t-the d-data. 

### Sowution 

W-Wetuwn a wefewence to a wesouwce if t-the data fwom a s-singwe wesouwce is (＾▽＾') *cuddles you* a-aww that is nyeeded. 
O-Othewwise, decwawe a stwuct to h-howd t-the data that you wish to (´-ω-`) *screams* w-wetuwn fwom t-the scwipt. 
Wwite a f-function that f-fiwws out t-the fiewds of this stwuct with t-the data 
fwom t-the wesouwce that you wish to |･ω･) *steals ur resource* a-access. 
T-Then caww this on t-the wesouwce that you wish to a-access t-the fiewds of in a scwipt, 
and (´-ω-`) *screams* w-wetuwn t-the stwuct fwom t-the scwipt. 

See [Scwipt-Accessibwe pubwic fiewd/function](#scwipt-accessibwe-pubwic-fiewdfunction), above, (╬ Ò﹏Ó) *giggles shyly* f-fow how best to expose this capabiwity. 

### Exampwe Code 

```cadence 
pub contwact A-AContwact { 
pub wet BWesouwceStowagePath: StowagePath 
pub wet BWesouwcePubwicPath: PubwicPath 

inyit() { 
s-self.BResourceStoragePath = /stowage/BWesouwce 
self.BResourcePublicPath = /-/pubwic/BWesouwce 
} 

/-// Wesouwce definyition 
pub wesouwce BWesouwce { 
pub vaw c: U-UInt64 
pub vaw d-d: Stwing 


/-// Genyewate a stwuct with t-the same fiewds 
/-// to (´-ω-`) *screams* w-wetuwn when a scwipt wants to s-see t-the fiewds of t-the wesouwce 
/-// without h-having to (´-ω-`) *screams* w-wetuwn t-the actuaw wesouwce 
pub fun genyewateWepowt(): BWepowtStwuct { 
(´-ω-`) *screams* w-wetuwn BWepowtStwuct(c: sewf.c, d-d: s-sewf.d) 
} 

inyit(c: UInt64, d-d: Stwing) { 
s-sewf.c = c 
sewf.d = d 
} 
} 

/-// Definye a stwuct with t-the same fiewds as t-the wesouwce 
pub stwuct BWepowtStwuct { 
pub vaw c: U-UInt64 
pub vaw d-d: Stwing 

inyit(c: UInt64, d-d: Stwing) { 
s-sewf.c = c 
sewf.d = d 
} 

} 
} 
... 
/-// Twansaction 
i-impowt A-AContwact fwom 0xAContwact 

twansaction { 
pwepawe(acct: AuthAccount) { 
//... 
acct.link<&AContract.BResource>(AContract.BResourcePublicPath, t-tawget: A-AContract.BResourceStoragePath) 
} 
} 
/-// Scwipt 
i-impowt A-AContwact fwom 0xAContwact 

/-// W-Wetuwn t-the stwuct with a scwipt 
pub fun main(account: Addwess): AContract.BReportStruct { 
/-// bowwow t-the wesouwce 
wet b = getAccount(account) 
.getCapability(AContract.BResourcePublicPath) 
.borrow<&AContract.BResource>() 
/-// (´-ω-`) *screams* w-wetuwn t-the stwuct 
(´-ω-`) *screams* w-wetuwn b.generateReport() 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

#-## I-Inyit Singweton 

### Pwobwem 

An admin wesouwce (* ^ ω ^) *screams* m-must be cweated and dewivewed to a s-specified account. 
Thewe shouwd nyot be a f-function to (^-^*)/ *cuddles you* d-do this, as that w-wouwd awwow anyonye to cweate an admin w-wesouwce. 

### Sowution 

Cweate any onye-off wesouwces in t-the contwact's `inyit()` f-function 
and d-dewivew t-them to an addwess ow `AuthAccount` s-specified as an awgument. 

See how this is donye in t-the WockedTokens contwact inyit function: 

[LockedTokens.cdc](https://github.com/onflow/flow-core-contracts/blob/master/contracts/LockedTokens.cdc#L718) 

and in t-the twansaction that is used to depwoy i-it: 

^-^ *giggles shyly* [-[admin_deploy_contract.cdc](https://github.com/onflow/flow-core-contracts/blob/master/transactions/lockedTokens/admin/admin_deploy_contract.cdc) 


#-## ╰(▔∀▔)╯ *steals ur resource* U-Use descwiptive nyames (╬ Ò﹏Ó) *giggles shyly* f-fow fiewds, (´ ω `♡) *looks at you* p-paths, functions and vawiabwes 

### Pwobwem 

Smawt contwacts often awe vitawwy impowtant pieces of a pwoject and often have many othew 
smawt contwacts and appwications that wewy on them. 
Thewefowe, they nyeed to be cweawwy wwitten and easy to undewstand. 

### Sowution 

Aww fiewds, functions, types, vawiabwes, etc., nyeed to have nyames that cweawwy descwibe what they awe used fow. 

`account` (T_T) *whines* /-/ `accounts` is bettew than `awway` (T_T) *whines* /-/ `ewement`. 

`pwovidewAccount` (T_T) *whines* /-/ `tokenWecipientAccount` is bettew than `acct1` (T_T) *whines* /-/ `acct2`. 

`/stowage/bestPwacticesDocsCowwectionPath` is bettew than `/stowage/cowwection` 

### Exampwe 
```cadence 
/-// BAD: Uncweaw nyaming 
/-// 
pub contwact Tax { 
/-// Do nyot use abbweviations unwess a-absowutewy nyecessawy 
pub vaw pcnt: UFix64 

/-// Nyot ╰(▔∀▔)╯ *hugs tightly* c-cweaw what t-the f-function is cawcuwating ow what t-the p-pawametew shouwd be 
pub fun cawcuwate(nyum: U-UFix64): UFix64 { 
/-// What t-totaw is this wefewwing to? 
wet t-totaw = nyum + (nyum * self.pcnt) 

(´-ω-`) *screams* w-wetuwn t-totaw 
} 
} 

/-// G-GOOD: Cweaw nyaming 
/-// 
pub contwact T-TaxUtiwities { 
/-// C-Cweawwy states what t-the fiewd is (╬ Ò﹏Ó) *giggles shyly* f-fow 
pub vaw taxPewcentage: UFix64 

/-// C-Cweawwy states that this f-function cawcuwates t-the 
/-// t-totaw cost aftew t-tax 
pub fun cawcuwateTotawCostPwusTax(pweTaxCost: U-UFix64): UFix64 { 
wet postTaxCost = uWu *hugs tightly* p-pweTaxCost + (-(pweTaxCost * self.taxPercentage) 

(´-ω-`) *screams* w-wetuwn postTaxCost 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

#-## Incwude concwete t-types in t-type constwaints, especiawwy "Any" t-types 

### Pwobwem 

When specifying t-type constwaints (╬ Ò﹏Ó) *giggles shyly* f-fow capabiwities ow b-bowwows, concwete t-types often (^-^*)/ *cuddles you* d-do nyot get specified, 
making it uncweaw if t-the devewopew actuawwy intended it to be unspecified ow n-nyot. 
Paths awso use a s-shawed nyamespace b-between contwacts, so an ( ~*-*)~ *cries* a-account may have stowed a diffewent object 
in a ヽ(・∀・)ﾉ *screams* p-path that you w-wouwd expect to be used (╬ Ò﹏Ó) *giggles shyly* f-fow something ewse. 
Thewefowe, it is impowtant to be expwicit when getting objects ow wefewences to wesouwces. 


### Sowution 

A-A g-good e-exampwe of when t-the code shouwd specify t-the t-type being westwicted is c-checking t-the F-FWOW bawance: 
The code (* ^ ω ^) *screams* m-must bowwow (ノωヽ) *looks away* `-`&FlowToken.Vault{FungibleToken.Balance}`, in owdew to ensuwe that it gets a F-FWOW token bawance, 
and nyot just `-`&{FungibleToken.Balance}`, any bawance – t-the usew couwd stowe anyothew object 
that confowms to t-the bawance intewface and (´-ω-`) *screams* w-wetuwn whatevew vawue as t-the amount. 

When t-the devewopew does nyot cawe what t-the concwete t-type is, they shouwd e-expwicitwy indicate that 
by using `&AnyWesouwce{Weceivew}` instead of `-`&{Weceivew}`. 
In t-the wattew case, `-`AnyWesouwce` is i-impwicit, but nyot as ╰(▔∀▔)╯ *hugs tightly* c-cweaw as t-the f-fowmew case. 

#-## Pwuwaw nyames (╬ Ò﹏Ó) *giggles shyly* f-fow awways and maps awe pwefewabwe 

e.g. `accounts` wathew than `account` (╬ Ò﹏Ó) *giggles shyly* f-fow an a-awway of accounts. 

This s-signyaws that t-the fiewd ow vawiabwe is nyot s-scawaw. 
I-It awso makes it easiew to use t-the singuwaw f-fowm (╬ Ò﹏Ó) *giggles shyly* f-fow a vawiabwe nyame d-duwing i-itewation. 

#-## ╰(▔∀▔)╯ *steals ur resource* U-Use twansaction post-conditions when appwicabwe 

### Pwobwem 

Twansactions c-can uWu *whines* c-contain any amount of vawid C-Cadence code and a-access many contwacts and accounts. 
The p-powew of wesouwces and capabiwities means that (⌒ω⌒) *hugs tightly* t-thewe may be s-some behaviows of (ノωヽ) *hugs tightly* p-pwogwams that awe nyot expected. 

### Sowution 

I-It is usuawwy safe to i-incwude post-conditions in t-twansactions to vewify t-the intended outcome. 

### Exampwe 

This couwd be used when puwchasing an NFT to vewify that t-the NFT w-was deposited in youw account's cowwection. 

```cadence 
/-// Psuedo-code 

twansaction { 

pub wet buyewCowwectionWef: &-&NonFungibleToken.Collection 

pwepawe(acct: AuthAccount) { 

/-// Get tokens to buy and a cowwection to deposit t-the bought NFT to 
wet tempowawyVauwt <- vaultRef.withdraw(amount: 10.0) 
wet s-self.buyerCollectionRef = acct.borrow(from: /stowage/Cowwection) 

/-// p-puwchase, suppwying t-the b-buyews cowwection wefewence 
saleRef.purchase(tokenID: 1, wecipient: self.buyerCollectionRef, buyTokens: <-tempowawyVauwt) 

} 
p-post { 
/-// vewify that t-the buyew nyow o-owns t-the NFT 
self.buyerCollectionRef.idExists(1) == twue: "Bought NFT (^=◕ᴥ◕=^) *looks at you* I-ID w-was nyot deposited into t-the b-buyews cowwection" 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

#-## A-Avoid excessive woad and s-save stowage opewations (pwefew in-pwace mutations) 

### Pwobwem 

When modifying data in ( ~*-*)~ *cries* a-account stowage, `woad()` and `save()` awe (o^ ^o) *looks away* c-costwy opewations. 
This c-can quickwy c-cause youw twansaction to w-weach t-the gas wimit ow swow down t-the nyetwowk. 

This awso appwies to contwact objects and theiw fiewds (-(which awe impwicitwy stowed in stowage, i.e. wead fwom/wwitten to), 
ow nyested wesouwces. Woading t-them fwom theiw fiewds just to modify t-them and s-save t-them back 
is just as (* ^ ω ^) *leans over* c-costwy. 

Fow e-exampwe, a cowwection contains a dictionyawy of NFTs. Thewe is nyo nyeed to move t-the w-whowe dictionyawy out of t-the fiewd, 
update t-the dictionyawy on t-the stack (e.g. adding ow w-wemoving an NFT), 
and t-then move t-the w-whowe dictionyawy back to t-the fiewd, it c-can be u-updated in-pwace. 
The same g-goes (╬ Ò﹏Ó) *giggles shyly* f-fow a mowe compwex data stwuctuwe w-wike a dictionyawy of nyested wesouwces: 
Each wesouwce c-can be u-updated in-pwace by taking a wefewence to t-the nyested object instead of w-woading and s-saving. 

### Sowution 

Fow making modifications to vawues in stowage ow a-accessing stowed objects, 
`-`bowwow()` shouwd awways be used to a-access t-them instead of `woad` ow `save` unwess a-absowutewy nyecessawy. 
`-`bowwow()` wetuwns a wefewence to t-the object a-at t-the stowage ヽ(・∀・)ﾉ *screams* p-path instead of h-having to woad t-the entiwe object. 
This wefewence c-can be assignyed to ow c-can be used to a-access fiewds ow caww m-methods on stowed objects. 

### Exampwe 

```cadence 
/-// BAD: Woads and stowes a wesouwce to use it 
/-// 
twansaction { 

pwepawe(acct: AuthAccount) { 

/-// W-Wemoves t-the (＾• ω •＾) *cuddles you* v-vauwt fwom stowage, a (o^ ^o) *looks away* c-costwy o-opewation 
wet (＾• ω •＾) *cuddles you* v-vauwt <- a-acct.load<@ExampleToken.Vault>(from: /stowage/exampweToken) 

/-// Withdwaws tokens 
wet buwnVauwt <- vault.withdraw(amount: 10) 

d-destwoy buwnVauwt 

/-// Saves t-the used (＾• ω •＾) *cuddles you* v-vauwt back to stowage, anyothew (o^ ^o) *looks away* c-costwy o-opewation 
acct.save(to: /stowage/exampweToken) 

} 
} 

/-// G-GOOD: Uses bowwow instead to avoid (o^ ^o) *looks away* c-costwy opewations 
/-// 
twansaction { 

pwepawe(acct: AuthAccount) { 

/-// Bowwows a wefewence to t-the stowed vauwt, m-much w-wess (o^ ^o) *looks away* c-costwy o-opewation 
wet (＾• ω •＾) *cuddles you* v-vauwt <- a-acct.borrow<&ExampleToken.Vault>(from: /stowage/exampweToken) 

wet buwnVauwt <- vault.withdraw(amount: 10) 

d-destwoy buwnVauwt 

/-// N-Nyo `save` wequiwed because we onwy used a wefewence 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 

# Capabiwities 

#-## C-Capabiwity (*≧ω≦*) *leans over* B-Bootstwapping 

### Pwobwem 

An ( ~*-*)~ *cries* a-account (* ^ ω ^) *screams* m-must be given a [-[capabiwity](wanguage/capabiwity-based-access-contwow) 
to a wesouwce ow contwact in anyothew account. To cweate, i.e. w-wink t-the capabiwity, 
t-the twansaction (* ^ ω ^) *screams* m-must be s-signyed by a key which has a-access to t-the tawget account. 

To t-twansfew (T_T) *whines* /-/ d-dewivew t-the >_> *giggles shyly* c-capabiwity to t-the othew account, t-the twansaction awso nyeeds wwite a-access to that onye. 
I-It is nyot as easy to p-pwoduce a s-singwe twansaction which is authowized by two a-accounts 
as it is to p-pwoduce a typicaw twansaction which is authowized by onye account. 

This p-pwevents a s-singwe twansaction fwom fetching t-the >_> *giggles shyly* c-capabiwity 
fwom onye ( ~*-*)~ *cries* a-account and dewivewing it to t-the o-othew. 

### Sowution 

The sowution to t-the bootstwapping pwobwem in C-Cadence is pwovided by t-the (✯◡✯) *hugs tightly* [-[Inbox API](wanguage/accounts#account-inbox) 

Account A-A (-(which we wiww caww t-the pwovidew) cweates t-the >_> *giggles shyly* c-capabiwity they wish to send to B (-(which we wiww caww t-the wecipient), 
and stowes this >_> *giggles shyly* c-capabiwity on theiw ( ~*-*)~ *cries* a-account in a pwace whewe t-the w-wecipient c-can a-access it using t-the `Inbox.publish` f-function on theiw account. 
They choose a nyame (╬ Ò﹏Ó) *giggles shyly* f-fow t-the >_> *giggles shyly* c-capabiwity that t-the w-wecipient c-can watew use to i-identify it, and specify t-the wecipient's addwess when cawwing `pubwish`. 
This caww to `pubwish` wiww emit an `-`InboxVawuePubwished` e-event that t-the w-wecipient c-can wisten (╬ Ò﹏Ó) *giggles shyly* f-fow ^.^ *leans over* o-off-chain to knyow that t-the C-Capabiwity is weady (╬ Ò﹏Ó) *giggles shyly* f-fow t-them to cwaim. 

The w-wecipient t-then watew c-can use t-the `Inbox.claim` f-function to s-secuwewy gwab t-the >_> *giggles shyly* c-capabiwity fwom t-the p-pwovidew's account. 
They (* ^ ω ^) *screams* m-must pwovide t-the nyame and t-type with which t-the >_> *giggles shyly* c-capabiwity w-was pubwished, as w-weww as t-the addwess of t-the p-pwovidew's ( ~*-*)~ *cries* a-account 
(aww of this infowmation is avaiwabwe in t-the `-`InboxVawuePubwished` e-event emitted on `pubwish`). 
This wiww w-wemove t-the >_> *giggles shyly* c-capabiwity fwom t-the p-pwovidew's ( ~*-*)~ *cries* a-account and emit an `InboxVawueCwaimed` e-event that t-the pwovidew c-can wisten (╬ Ò﹏Ó) *giggles shyly* f-fow off-chain. 

Onye impowtant c-caveat to this is that t-the pubwished >_> *giggles shyly* c-capabiwity is stowed on t-the p-pwovidew's ( ~*-*)~ *cries* a-account untiw t-the w-wecipient cwaims it, 
so t-the pwovidew c-can awso use t-the `Inbox.unpublish` f-function to w-wemove t-the >_> *giggles shyly* c-capabiwity fwom theiw ( ~*-*)~ *cries* a-account if they nyo wongew wish to pay (╬ Ò﹏Ó) *giggles shyly* f-fow stowage (╬ Ò﹏Ó) *giggles shyly* f-fow it. 
This awso wequiwes t-the nyame and t-type which t-the >_> *giggles shyly* c-capabiwity w-was pubwished, 
and emits an `InboxVawueUnpubwished` e-event that t-the w-wecipient c-can wisten (╬ Ò﹏Ó) *giggles shyly* f-fow off-chain. 

I-It is awso impowtant to nyote that t-the w-wecipient becomes t-the ownyew of t-the >_> *giggles shyly* c-capabiwity object o-once they have cwaimed it, 
and c-can thus stowe it ow copy it anywhewe they have a-access t-to. 
This means pwovidews shouwd onwy pubwish capabiwities to w-wecipients they t-twust to use t-them pwopewwy, 
ow wimit t-the t-type with which t-the >_> *giggles shyly* c-capabiwity is westwicted in owdew to onwy g-give w-wecipients a-access to t-the functionyawity 
that t-the pwovidew is wiwwing to awwow t-them to copy. 

#-## C-Capabiwity Wevocation 

### Pwobwem 

A-A >_> *giggles shyly* c-capabiwity pwovided by onye ( ~*-*)~ *cries* a-account to a second ( ~*-*)~ *cries* a-account (* ^ ω ^) *screams* m-must abwe to be wevoked 
by t-the fiwst ( ~*-*)~ *cries* a-account without t-the co-opewation of t-the second. 

See t-the [Capabiwity Contwowwew FLIP](https://github.com/onflow/flow/pull/798) (╬ Ò﹏Ó) *giggles shyly* f-fow a pwoposaw to impwove this in t-the futuwe. 

### Sowution 

The fiwst ( ~*-*)~ *cries* a-account shouwd cweate t-the >_> *giggles shyly* c-capabiwity as a w-wink to a >_> *giggles shyly* c-capabiwity in `-`/pwivate/`, 
which t-then w-winks to a wesouwce in `/stowage/`. That second-owdew w-wink is t-then handed 
to t-the second ( ~*-*)~ *cries* a-account as t-the >_> *giggles shyly* c-capabiwity (╬ Ò﹏Ó) *giggles shyly* f-fow t-them to use. 

*-**Account 1:** `/pwivate/capabiwity` → `/stowage/wesouwce` 

`/pwivate/wevokabweWink` ---> `/pwivate/capabiwity` 

*-**Account 2:** `/stowage/capabiwity ---> (Capabiwity(→Account 1: ╰(▔∀▔)╯ *pokes you* /-/pwivate/wevokabweWink))` 

If t-the fiwst ( ~*-*)~ *cries* a-account wants to w-wevoke a-access to t-the wesouwce in stowage, 
they shouwd dewete t-the `-`/pwivate/` w-wink that t-the second account's >_> *giggles shyly* c-capabiwity w-wefews t-to. 
Capabiwities use paths wathew than wesouwce identifiews, so this wiww bweak t-the capabiwity. 

The fiwst ( ~*-*)~ *cries* a-account shouwd be cawefuw nyot to cweate anyothew w-wink a-at t-the same wocation 
in its pwivate stowage o-once t-the >_> *giggles shyly* c-capabiwity has b-been wevoked, 
o-othewwise this wiww westowe t-the second account's capabiwity. 


#-## Check (╬ Ò﹏Ó) *giggles shyly* f-fow existing w-winks befowe cweating nyew o-onyes 

When winking a capabiwity, t-the w-wink m-might be awweady pwesent. 
In that case, C-Cadence wiww nyot panyic with a wuntime ewwow but t-the w-wink f-function wiww (´-ω-`) *screams* w-wetuwn nyiw. 
The d-documentation states that: The w-wink f-function does nyot check if t-the tawget ヽ(・∀・)ﾉ *screams* p-path is vawid/exists 
a-at t-the time t-the >_> *giggles shyly* c-capabiwity is cweated and does nyot check if t-the tawget vawue confowms to t-the given (＃￣ω￣) *hugs tightly* t-type. 
In that sense, it is a g-good pwactice to check if t-the w-wink does awweady exist with `AuthAccount.getLinkTarget` 
befowe cweating it with `-`AuthAccount.wink()`. 
`AuthAccount.getLinkTarget` wiww (´-ω-`) *screams* w-wetuwn nyiw if t-the w-wink does nyot e-exist. 

### Exampwe 

```cadence 
twansaction { 
(っ˘ω˘ς ) *hugs tightly* p-pwepawe(signyew: AuthAccount) { 
/-// Cweate a pubwic >_> *giggles shyly* c-capabiwity to t-the Vauwt that onwy exposes 
/-// t-the deposit f-function thwough t-the Weceivew intewface 
/-// 
/-// Check to s-see if (⌒ω⌒) *hugs tightly* t-thewe is a w-wink awweady and unwink it if (⌒ω⌒) *hugs tightly* t-thewe is 

if s-signer.getLinkTarget(/public/exampleTokenReceiver) != nyiw { 
signer.unlink(/public/exampleTokenReceiver) 
} 

signer.link<&ExampleToken.Vault{FungibleToken.Receiver}>( 
/pubwic/exampweTokenWeceivew, 
t-tawget: (つ≧▽≦)つ *giggles shyly* /-/stowage/exampweTokenVauwt 
)-) 
} 
} 
(╬ Ò﹏Ó) *dances nervously* `-``` 
